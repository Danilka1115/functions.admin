<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#1a1a1a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>–í–∏–¥–µ–æ–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ - —ç–ª–µ–∫—Ç—Ä–æ–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

:root {
    /* Telegram Theme Variables (will be set by JavaScript) */
    --tg-theme-bg-color: #1a1a1a;
    --tg-theme-secondary-bg-color: #2a2a2a;
    --tg-theme-text-color: #ffffff;
    --tg-theme-hint-color: #888888;
    --tg-theme-link-color: #0088cc;
    --tg-theme-button-color: #0088cc;
    --tg-theme-button-text-color: #ffffff;
    
    /* Fallback colors */
    --bg-primary: var(--tg-theme-bg-color, #1a1a1a);
    --bg-secondary: var(--tg-theme-secondary-bg-color, #2a2a2a);
    --bg-tertiary: #1e1e1e;
    --accent-blue: var(--tg-theme-link-color, #0088cc);
    --text-primary: var(--tg-theme-text-color, #ffffff);
    --text-secondary: #b0b0b0;
    --text-placeholder: var(--tg-theme-hint-color, #888888);
    --grid-pattern: rgba(255, 255, 255, 0.03);
    
    /* Viewport variables */
    --viewport-height: 100vh;
    --viewport-stable-height: 100vh;
    --safe-area-top: 0px;
    --safe-area-bottom: 0px;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    background-color: #cfcfcf;
    color: var(--text-primary);
    min-height: var(--viewport-height, 100vh);
    padding-bottom: calc(80px + var(--safe-area-bottom, 0px));
    padding-top: var(--safe-area-top, 0px);
    overflow-x: hidden;
    transition: background-color 0.3s ease, color 0.3s ease;
}

/* Telegram theme support */
body.theme-dark {
    --bg-primary: var(--tg-theme-bg-color, #1a1a1a);
    --bg-secondary: var(--tg-theme-secondary-bg-color, #2a2a2a);
    --text-primary: var(--tg-theme-text-color, #ffffff);
}

body.theme-light {
    --bg-primary: var(--tg-theme-bg-color, #ffffff);
    --bg-secondary: var(--tg-theme-secondary-bg-color, #f0f0f0);
    --text-primary: var(--tg-theme-text-color, #000000);
    --text-secondary: #666666;
    --grid-pattern: rgba(0, 0, 0, 0.03);
}

/* App ready state */
body.app-ready {
    opacity: 1;
    transition: opacity 0.3s ease;
}

body:not(.app-ready) {
    opacity: 0;
}

/* App Header */
.app-header {
    background-color: var(--bg-secondary);
    border-radius: 0 0 16px 16px;
    padding: 12px 16px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 16px;
}

.close-btn {
    background: none;
    border: none;
    color: var(--tg-theme-button-color, #9b5cff);
    font-size: 16px;
    cursor: pointer;
    padding: 8px;
    transition: opacity 0.2s ease;
    -webkit-tap-highlight-color: transparent;
}

.close-btn:active {
    opacity: 0.7;
}

.header-title {
    flex: 1;
    text-align: center;
}

.header-spacer {
    width: 40px;
    height: 40px;
}

.header-title h1 {
    font-size: 18px;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0;
}

.subtitle {
    font-size: 12px;
    color: var(--text-secondary);
    margin: 2px 0 0 0;
}

.menu-btn {
    background: none;
    border: none;
    cursor: pointer;
    padding: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Main Content */
.main-content {
    padding: 0 16px;
    max-width: 600px;
    margin: 0 auto;
}

/* Search Bar */
.search-container {
    margin-bottom: 16px;
}

.search-bar {
    background-color: var(--bg-secondary);
    border-radius: 12px;
    padding: 12px 16px;
    display: flex;
    align-items: center;
    gap: 12px;
}

.search-icon {
    color: var(--text-placeholder);
    flex-shrink: 0;
}

.search-input {
    flex: 1;
    background: none;
    border: none;
    color: var(--text-primary);
    font-size: 16px;
    outline: none;
}

.search-input::placeholder {
    color: var(--text-placeholder);
}

/* Tools page */
.tools-page {
    display: none;
    padding: 0 16px 24px;
}

.tools-page.active {
    display: block;
}

.tools-page.active ~ .content-grid {
    display: none;
}

.tools-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin: 8px 0 14px;
}

.tools-title {
    font-size: 18px;
    font-weight: 700;
    color: var(--text-primary);
}

.tools-back {
    background: none;
    border: none;
    color: var(--accent-blue);
    font-size: 14px;
    cursor: pointer;
    padding: 6px 8px;
}

.tools-search {
    margin-bottom: 12px;
}

.tools-sort {
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--text-secondary);
    font-size: 13px;
    margin-bottom: 14px;
}

.tools-list {
    display: grid;
    gap: 12px;
}

.tools-card {
    background: var(--bg-secondary);
    border-radius: 16px;
    overflow: hidden;
    border: 1px solid rgba(255, 255, 255, 0.06);
}

.tools-card-media {
    position: relative;
    aspect-ratio: 16 / 9;
    background: #1a1a1a;
}

.tools-card-media img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
}

.tools-card-badge {
    position: absolute;
    left: 10px;
    bottom: 10px;
    background: rgba(0, 0, 0, 0.7);
    color: #ffffff;
    font-size: 12px;
    padding: 4px 8px;
    border-radius: 10px;
}

.tools-card-body {
    padding: 12px 14px 14px;
}

.tools-card-title {
    font-size: 14px;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 6px;
}

.tools-card-desc {
    font-size: 12px;
    color: var(--text-secondary);
    line-height: 1.4;
}

.videos-page {
    display: none;
}

.videos-page.active {
    display: block;
}

/* Catalog Page */
.catalog-page {
    display: none;
    padding: 0 16px 24px;
}

.catalog-page.active {
    display: block;
}

.catalog-page.active ~ .content-grid {
    display: none;
}

.catalog-content {
    padding-top: 8px;
}

/* My Tools Page (Purchased Tools) */
.my-tools-page {
    display: none;
    padding: 0 16px 24px;
}

.my-tools-page.active {
    display: block;
}

.my-tools-page.active ~ .content-grid,
.content-grid:has(~ .my-tools-page.active) {
    display: none;
}

/* –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–∫—Ä—ã—Ç–∏—è –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–æ–≤ –±–µ–∑ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ :has() */
body:has(.my-tools-page.active) .content-grid {
    display: none;
}

.my-tools-content {
    min-height: 60vh;
}

.refresh-btn {
    background: none;
    border: none;
    color: var(--accent-blue);
    cursor: pointer;
    padding: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
    transition: background-color 0.2s;
}

.refresh-btn:active {
    background-color: rgba(0, 136, 204, 0.1);
}

.refresh-btn svg {
    animation: none;
}

.refresh-btn.loading svg {
    animation: spin 1s linear infinite;
}

@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

.my-tools-empty {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 60px 20px;
    text-align: center;
}

.empty-icon {
    width: 80px;
    height: 80px;
    margin-bottom: 20px;
    opacity: 0.5;
    color: var(--text-secondary);
}

.my-tools-empty h3 {
    font-size: 18px;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 8px;
}

.my-tools-empty p {
    font-size: 14px;
    color: var(--text-secondary);
    margin-bottom: 24px;
}

.my-tools-list {
    display: grid;
    gap: 12px;
}

.my-tool-card {
    background: var(--bg-secondary);
    border-radius: 16px;
    overflow: hidden;
    border: 1px solid rgba(255, 255, 255, 0.06);
    display: grid;
    grid-template-columns: 100px 1fr;
    gap: 12px;
    padding: 12px;
    align-items: center;
}

.my-tool-image {
    width: 100px;
    height: 100px;
    border-radius: 12px;
    background: #1a1a1a;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
}

.my-tool-image img {
    width: 100%;
    height: 100%;
    object-fit: contain;
}

.my-tool-info {
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.my-tool-name {
    font-size: 15px;
    font-weight: 700;
    color: var(--text-primary);
    line-height: 1.3;
}

.my-tool-date {
    font-size: 12px;
    color: var(--text-secondary);
    display: flex;
    align-items: center;
    gap: 4px;
}

.my-tool-date svg {
    width: 14px;
    height: 14px;
}

.my-tool-actions {
    display: flex;
    gap: 8px;
    margin-top: 8px;
}

.my-tool-action-btn {
    flex: 1;
    padding: 8px 12px;
    font-size: 13px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    transition: opacity 0.2s;
}

.my-tool-action-btn:active {
    opacity: 0.8;
}

.my-tool-action-btn.primary {
    background-color: var(--tg-theme-button-color, var(--accent-blue));
    color: var(--tg-theme-button-text-color, #ffffff);
}

.my-tool-action-btn.secondary {
    background-color: rgba(255, 255, 255, 0.1);
    color: var(--text-primary);
}

/* Promo Section */
.promo-section {
    background: linear-gradient(135deg, var(--accent-blue) 0%, #0066aa 100%);
    border-radius: 16px;
    padding: 20px;
    margin-bottom: 24px;
}

.promo-header {
    display: flex;
    align-items: flex-start;
    gap: 16px;
    margin-bottom: 20px;
}

.promo-icon {
    flex-shrink: 0;
    width: 48px;
    height: 48px;
    background-color: rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.promo-content h2 {
    font-size: 18px;
    font-weight: 700;
    color: white;
    margin-bottom: 4px;
}

.promo-content p {
    font-size: 14px;
    color: rgba(255, 255, 255, 0.9);
    display: flex;
    align-items: center;
    gap: 4px;
}

.chevron {
    font-size: 16px;
    margin-left: 4px;
}

.promo-stats {
    display: flex;
    justify-content: space-around;
    border-top: 1px solid rgba(255, 255, 255, 0.2);
    padding-top: 16px;
    gap: 12px;
}

.stat-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    flex: 1;
}

.stat-number {
    font-size: 20px;
    font-weight: 700;
    color: white;
}

.stat-label {
    font-size: 11px;
    color: rgba(255, 255, 255, 0.8);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* Content Grid */
.content-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
    margin-bottom: 24px;
}

.grid-item {
    background-color: #d9d9d9;
    border-radius: 16px;
    padding: 20px;
    position: relative;
    cursor: pointer;
    transition: transform 0.2s, background-color 0.2s;
    background-image: none;
    min-height: 180px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: space-between;
    -webkit-tap-highlight-color: transparent;
    user-select: none;
}

.grid-item:active {
    transform: scale(0.98);
    background-color: var(--bg-secondary);
    transition: transform 0.1s, background-color 0.1s;
}

.item-icon {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 20px 0;
    width: 150px;
    height: 150px;
    align-self: center;
    background: transparent;
    border-radius: 10px;
}

.grid-item.is-jigsaw .item-icon {
    width: 170px;
    height: 170px;
}

.item-icon img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    padding: 0;
    display: block;
    border-radius: 10px;
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.35);
    filter: saturate(1.08) contrast(1.05) brightness(0.98);
    transform: scale(var(--img-scale, 1));
    transform-origin: center;
}


.grid-item h3 {
    font-size: 14px;
    font-weight: 700;
    text-transform: uppercase;
    color: #000000;
    text-align: center;
    line-height: 1.3;
    margin: 0;
}

/* Product Section */
.product-section {
    margin-top: 20px;
}

.product-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 12px;
}

.product-card {
    background-color: #e3e3e3;
    border-radius: 16px;
    padding: 12px;
    display: grid;
    grid-template-columns: 80px 1fr;
    gap: 12px;
    align-items: center;
    border: 1px solid rgba(0, 0, 0, 0.06);
}

.product-image {
    width: 80px;
    height: 80px;
    border-radius: 12px;
    background: #f2f2f2;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
}

.product-image img {
    width: 100%;
    height: 100%;
    object-fit: contain;
}

.product-meta h3 {
    font-size: 14px;
    font-weight: 700;
    color: #000000;
    margin: 0 0 6px 0;
}

.product-meta p {
    font-size: 12px;
    color: #333333;
    margin: 0 0 8px 0;
}

.product-action {
    display: inline-flex;
    justify-content: center;
    width: fit-content;
    padding: 8px 12px;
    font-size: 13px;
    border-radius: 8px;
}

/* Videos Section */
.videos-section {
    margin-top: 24px;
    scroll-margin-top: 16px;
}

.section-header {
    margin-bottom: 12px;
}

.section-header h2 {
    font-size: 16px;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 6px;
}

.section-header p {
    font-size: 13px;
    color: var(--text-secondary);
    line-height: 1.4;
}

.video-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 12px;
}

.video-card {
    background-color: var(--bg-secondary);
    border-radius: 16px;
    overflow: hidden;
    border: 1px solid rgba(255, 255, 255, 0.06);
}

.video-thumb {
    aspect-ratio: 16 / 9;
    background:
        radial-gradient(1200px 300px at 20% 30%, rgba(0, 136, 204, 0.25), transparent 60%),
        radial-gradient(900px 260px at 80% 10%, rgba(255, 255, 255, 0.06), transparent 55%),
        linear-gradient(135deg, rgba(0, 136, 204, 0.18), rgba(0, 0, 0, 0.05));
    display: flex;
    align-items: center;
    justify-content: center;
}

.video-thumb svg {
    width: 56px;
    height: 56px;
    opacity: 0.9;
}

.video-meta {
    padding: 14px 14px 16px 14px;
}

.video-meta h3 {
    font-size: 14px;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 6px;
    line-height: 1.35;
}

.video-meta p {
    font-size: 12px;
    color: var(--text-secondary);
    line-height: 1.4;
    margin-bottom: 12px;
}

.video-actions {
    display: flex;
    gap: 10px;
    align-items: center;
}

.video-open.telegram-button {
    width: 100%;
    padding: 10px 14px;
    font-size: 14px;
    border-radius: 10px;
}

/* No results message */
.no-results-message {
    margin-top: 24px;
    padding: 40px 20px;
    text-align: center;
}

.no-results-message svg {
    margin-bottom: 16px;
    opacity: 0.5;
    color: var(--text-secondary);
}

.no-results-message h3 {
    font-size: 16px;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 8px;
}

.no-results-message p {
    font-size: 14px;
    color: var(--text-secondary);
}

/* Bottom Navigation */
.bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background-color: var(--bg-secondary);
    border-radius: 16px 16px 0 0;
    padding: 8px 0;
    padding-bottom: calc(8px + var(--safe-area-bottom, 0px));
    display: flex;
    justify-content: space-around;
    align-items: center;
    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.3);
    z-index: 1000;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
}

.nav-item {
    background: none;
    border: none;
    cursor: pointer;
    padding: 8px 12px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    color: var(--text-secondary);
    transition: color 0.2s, transform 0.1s;
    flex: 1;
    -webkit-tap-highlight-color: transparent;
    user-select: none;
    pointer-events: auto;
    position: relative;
    z-index: 1;
}

.nav-item:active {
    transform: scale(0.95);
}

.nav-item.active {
    color: var(--accent-blue);
}

.nav-item span {
    font-size: 11px;
    font-weight: 500;
}

.nav-icon {
    width: 24px;
    height: 24px;
    stroke: currentColor;
    fill: none;
    stroke-width: 2;
    stroke-linecap: round;
    stroke-linejoin: round;
}

/* Responsive adjustments */
@media (max-width: 375px) {
    .grid-item h3 {
        font-size: 12px;
    }
    
    .promo-content h2 {
        font-size: 16px;
    }
    
    .stat-number {
        font-size: 18px;
    }
}

/* Safe area for devices with notches */
@supports (padding: max(0px)) {
    .bottom-nav {
        padding-bottom: max(8px, env(safe-area-inset-bottom), var(--safe-area-bottom, 0px));
    }
    
    body {
        padding-bottom: max(80px, calc(80px + env(safe-area-inset-bottom)), calc(80px + var(--safe-area-bottom, 0px)));
    }
}

/* Telegram-specific styles */
.telegram-button {
    background-color: var(--tg-theme-button-color, var(--accent-blue));
    color: var(--tg-theme-button-text-color, #ffffff);
    border: none;
    border-radius: 8px;
    padding: 12px 24px;
    font-size: 16px;
    font-weight: 500;
    cursor: pointer;
    transition: opacity 0.2s ease;
    -webkit-tap-highlight-color: transparent;
}

.telegram-button:active {
    opacity: 0.8;
}

/* Loading state */
.loading {
    opacity: 0.6;
    pointer-events: none;
}

/* Smooth transitions for theme changes */
* {
    transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
}

/* Modal */
.modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.55);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 16px;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s ease;
    z-index: 2000;
}

.modal-overlay.open {
    opacity: 1;
    pointer-events: auto;
}

.modal-card {
    width: 100%;
    max-width: 420px;
    background: var(--bg-secondary);
    color: var(--text-primary);
    border-radius: 16px;
    padding: 16px;
    border: 1px solid rgba(255, 255, 255, 0.08);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.35);
}

.modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    margin-bottom: 10px;
}

.modal-header h2 {
    font-size: 16px;
    font-weight: 700;
    margin: 0;
}

.modal-close {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    border: none;
    background: rgba(255, 255, 255, 0.08);
    color: var(--text-primary);
    font-size: 20px;
    line-height: 1;
    cursor: pointer;
}

.modal-body {
    font-size: 13px;
    color: var(--text-secondary);
}

.modal-lead {
    margin: 0 0 8px 0;
}

.modal-list {
    display: grid;
    gap: 10px;
}

.modal-item {
    background: #ffffff;
    border-radius: 12px;
    padding: 10px 12px;
}

.modal-item-title {
    font-size: 13px;
    font-weight: 600;
    color: #000000;
    margin-bottom: 6px;
}

.modal-link {
    color: var(--accent-blue);
    text-decoration: none;
    font-size: 13px;
}

.modal-actions {
    margin-top: 14px;
}

.modal-action {
    display: inline-flex;
    width: 100%;
    justify-content: center;
    text-decoration: none;
}

.modal-grid {
    grid-template-columns: repeat(2, 1fr);
    margin-bottom: 12px;
}

.modal-grid .grid-item {
    cursor: default;
}
    </style>
</head>
<body class="app-ready">
    <!-- App Header -->
    <header class="app-header">
        <span class="header-spacer" aria-hidden="true"></span>
        <div class="header-title">
            <h1>–≠–ª–µ–∫—Ç—Ä–æ–∏–Ω—Å—Ä—É–º–µ–Ω—Ç—ã</h1>
        </div>
        <button class="menu-btn">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <circle cx="12" cy="6" r="2" fill="#0088cc"/>
                <circle cx="12" cy="12" r="2" fill="#0088cc"/>
                <circle cx="12" cy="18" r="2" fill="#0088cc"/>
            </svg>
        </button>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Tools Page (Drills & Screwdrivers) -->
        <section class="tools-page" id="tools-page">
            <div class="tools-header">
                <button class="tools-back" id="tools-back">‚Üê –ù–∞–∑–∞–¥</button>
                <span></span>
                <span></span>
            </div>
            <div class="tools-search">
                <div class="search-bar">
                    <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none">
                        <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
                        <path d="m21 21-4.35-4.35" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    <input type="text" placeholder="–ü–æ–∏—Å–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞..." class="search-input" id="tools-search-input">
                </div>
            </div>
            <div class="tools-sort">
                <span>–°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ</span>
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                    <path d="M7 10l5 5 5-5" stroke="currentColor" stroke-width="2" fill="none"/>
                </svg>
            </div>
            <div class="tools-list">
                <article class="tools-card">
                    <div class="tools-card-media">
                        <img src="https://storage.yandexcloud.net/miniappp/assets/drill.webp" alt="–î—Ä–µ–ª—å APEXWOLT 48–í">
                    </div>
                    <div class="tools-card-body">
                        <div class="tools-card-title">APEXWOLT 48–í</div>
                        <div class="tools-card-desc">–°—Ö–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è, –≤—ã–±–æ—Ä —Å–∫–æ—Ä–æ—Å—Ç–µ–π –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–º–µ–Ω—Ç–∞. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Å–≤–µ—Ä–ª–µ–Ω–∏—é –∏ –∑–∞–∫—Ä—É—á–∏–≤–∞–Ω–∏—é.</div>
                    </div>
                </article>
                <article class="tools-card">
                    <div class="tools-card-media">
                        <img src="https://storage.yandexcloud.net/miniappp/assets/drill.webp" alt="–î—Ä–µ–ª—å APEXWOLT 18–í">
                    </div>
                    <div class="tools-card-body">
                        <div class="tools-card-title">APEXWOLT 18–í</div>
                        <div class="tools-card-desc">–ü–æ—Ä—è–¥–æ–∫ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ —Ä–∞–±–æ—Ç–µ, –ø–æ–¥–±–æ—Ä –±–∏—Ç –∏ —Å–≤–µ—Ä–ª, —Ç–µ—Ö–Ω–∏–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ —É—Ö–æ–¥ –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.</div>
                    </div>
                </article>
            </div>
        </section>

        <!-- Catalog Page (Drills & Screwdrivers Catalog) -->
        <section class="catalog-page" id="catalog-page">
            <div class="tools-header">
                <button class="tools-back" id="catalog-back">‚Üê –ù–∞–∑–∞–¥</button>
                <span></span>
                <span></span>
            </div>
            
            <div class="catalog-content">
                <div class="section-header" style="margin-bottom: 20px;">
                    <h2 style="font-size: 20px; font-weight: 700; color: var(--text-primary); margin-bottom: 8px;">–ö–∞—Ç–∞–ª–æ–≥: –î—Ä–µ–ª–∏ –∏ —à—É—Ä—É–ø–æ–≤–µ—Ä—Ç—ã</h2>
                    <p style="font-size: 14px; color: var(--text-secondary); line-height: 1.4;">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –º–æ–¥–µ–ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤</p>
                </div>
                
                <div class="catalog-list">
                    <div class="catalog-item" style="background-color: var(--bg-secondary); border-radius: 16px; padding: 16px; margin-bottom: 12px; border: 1px solid rgba(255, 255, 255, 0.06);">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="width: 100px; height: 100px; border-radius: 12px; background: #1a1a1a; display: flex; align-items: center; justify-content: center; overflow: hidden; flex-shrink: 0;">
                                <img src="https://storage.yandexcloud.net/miniappp/assets/drill.webp" alt="APEXWOLT 48–í" style="width: 100%; height: 100%; object-fit: contain;">
                            </div>
                            <div style="flex: 1;">
                                <div style="font-size: 16px; font-weight: 700; color: var(--text-primary); margin-bottom: 6px;">APEXWOLT 48–í</div>
                                <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 12px; line-height: 1.4;">–ú–æ—â–Ω–∞—è –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä–Ω–∞—è –¥—Ä–µ–ª—å-—à—É—Ä—É–ø–æ–≤–µ—Ä—Ç —Å –≤—ã—Å–æ–∫–∏–º –∫—Ä—É—Ç—è—â–∏–º –º–æ–º–µ–Ω—Ç–æ–º</div>
                                <a href="https://—Ç–µ–ø–ª—ã–π–¥–æ–º38.—Ä—Ñ/–±—Ä–∞—Ç—Å–∫/?ysclid=mki3mdiiw2874168637" target="_blank" rel="noopener" class="telegram-button catalog-link" data-url="https://—Ç–µ–ø–ª—ã–π–¥–æ–º38.—Ä—Ñ/–±—Ä–∞—Ç—Å–∫/?ysclid=mki3mdiiw2874168637" style="display: inline-block; padding: 10px 20px; font-size: 14px; text-decoration: none; text-align: center; width: 100%;">üåê –°–º–æ—Ç—Ä–µ—Ç—å –≤ –∫–∞—Ç–∞–ª–æ–≥–µ</a>
                            </div>
                        </div>
                    </div>
                    
                    <div class="catalog-item" style="background-color: var(--bg-secondary); border-radius: 16px; padding: 16px; margin-bottom: 12px; border: 1px solid rgba(255, 255, 255, 0.06);">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="width: 100px; height: 100px; border-radius: 12px; background: #1a1a1a; display: flex; align-items: center; justify-content: center; overflow: hidden; flex-shrink: 0;">
                                <img src="https://storage.yandexcloud.net/miniappp/assets/drill.webp" alt="APEXWOLT 18–í" style="width: 100%; height: 100%; object-fit: contain;">
                            </div>
                            <div style="flex: 1;">
                                <div style="font-size: 16px; font-weight: 700; color: var(--text-primary); margin-bottom: 6px;">APEXWOLT 18–í</div>
                                <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 12px; line-height: 1.4;">–ö–æ–º–ø–∞–∫—Ç–Ω–∞—è –¥—Ä–µ–ª—å-—à—É—Ä—É–ø–æ–≤–µ—Ä—Ç –¥–ª—è –¥–æ–º–∞ –∏ –¥–∞—á–∏</div>
                                <a href="https://—Ç–µ–ø–ª—ã–π–¥–æ–º38.—Ä—Ñ/–±—Ä–∞—Ç—Å–∫/?ysclid=mki3mdiiw2874168637" target="_blank" rel="noopener" class="telegram-button catalog-link" data-url="https://—Ç–µ–ø–ª—ã–π–¥–æ–º38.—Ä—Ñ/–±—Ä–∞—Ç—Å–∫/?ysclid=mki3mdiiw2874168637" style="display: inline-block; padding: 10px 20px; font-size: 14px; text-decoration: none; text-align: center; width: 100%;">üåê –°–º–æ—Ç—Ä–µ—Ç—å –≤ –∫–∞—Ç–∞–ª–æ–≥–µ</a>
                            </div>
                        </div>
                    </div>
                    
                    <div class="catalog-item" style="background-color: var(--bg-secondary); border-radius: 16px; padding: 16px; margin-bottom: 12px; border: 1px solid rgba(255, 255, 255, 0.06);">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="width: 100px; height: 100px; border-radius: 12px; background: #1a1a1a; display: flex; align-items: center; justify-content: center; overflow: hidden; flex-shrink: 0;">
                                <img src="https://storage.yandexcloud.net/miniappp/assets/drill.webp" alt="–ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ –º–æ–¥–µ–ª–∏" style="width: 100%; height: 100%; object-fit: contain;">
                            </div>
                            <div style="flex: 1;">
                                <div style="font-size: 16px; font-weight: 700; color: var(--text-primary); margin-bottom: 6px;">–ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ –º–æ–¥–µ–ª–∏ –¥–ª—è –¥–æ–º–∞</div>
                                <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 12px; line-height: 1.4;">–õ–µ–≥–∫–∏–µ –∏ —É–¥–æ–±–Ω—ã–µ –º–æ–¥–µ–ª–∏ –¥–ª—è –±—ã—Ç–æ–≤–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</div>
                                <a href="https://—Ç–µ–ø–ª—ã–π–¥–æ–º38.—Ä—Ñ/–±—Ä–∞—Ç—Å–∫/?ysclid=mki3mdiiw2874168637" target="_blank" rel="noopener" class="telegram-button catalog-link" data-url="https://—Ç–µ–ø–ª—ã–π–¥–æ–º38.—Ä—Ñ/–±—Ä–∞—Ç—Å–∫/?ysclid=mki3mdiiw2874168637" style="display: inline-block; padding: 10px 20px; font-size: 14px; text-decoration: none; text-align: center; width: 100%;">üåê –°–º–æ—Ç—Ä–µ—Ç—å –≤ –∫–∞—Ç–∞–ª–æ–≥–µ</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- My Tools Page (Purchased Tools) -->
        <section class="my-tools-page" id="my-tools-page">
            <div class="tools-header">
                <span></span>
                <span></span>
                <button class="refresh-btn" id="refresh-purchases" title="–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫" style="cursor: pointer; pointer-events: auto;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                        <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
            <div class="my-tools-content">
                <div class="my-tools-empty" id="my-tools-empty" style="display: none;">
                    <div class="empty-icon">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none">
                            <path d="M14.7 6.3a3 3 0 0 0-4.2 4.2L3 18l3 3 7.5-7.5a3 3 0 0 0 4.2-4.2l-3 3-3-3 3-3z" stroke="currentColor" stroke-width="2" fill="none" stroke-linejoin="round" stroke-linecap="round"/>
                        </svg>
                    </div>
                    <h3>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤</h3>
                    <p>–ö—É–ø–ª–µ–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å</p>
                    <button class="telegram-button" onclick="showWhereToBuy()">–ì–¥–µ –∫—É–ø–∏—Ç—å?</button>
                </div>
                <div class="my-tools-list" id="my-tools-list">
                    <!-- –°–ø–∏—Å–æ–∫ –∫—É–ø–ª–µ–Ω–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
        </section>

        <!-- Content Grid -->
        <div class="content-grid">
            <div class="grid-item">
                <div class="item-icon">
                    <img style="--img-scale: 1.15" src="https://storage.yandexcloud.net/miniappp/assets/drill.webp" alt="–î—Ä–µ–ª—å –∏ —à—É—Ä—É–ø–æ–≤–µ—Ä—Ç">
                </div>
                <h3>–î–†–ï–õ–ò –ò<br>–®–£–†–£–ü–û–í–ï–†–¢–´</h3>
            </div>

            <div class="grid-item" data-url="https://t.me/APEXWOLT1/10">
                <div class="item-icon">
                    <img style="--img-scale: 1.15" src="https://storage.yandexcloud.net/miniappp/assets/grinder.webp" alt="–ë–æ–ª–≥–∞—Ä–∫–∞ (–£–®–ú)">
                </div>
                <h3>–ë–û–õ–ì–ê–†–ö–ò<br>(–£–®–ú)</h3>
            </div>

            <div class="grid-item is-jigsaw">
                <div class="item-icon">
                    <img src="assets/photolobzik-miniapp.png" alt="–õ–æ–±–∑–∏–∫">
                </div>
                <h3>–õ–û–ë–ó–ò–ö–ò</h3>
            </div>

            <div class="grid-item">
                <div class="item-icon">
                    <img style="--img-scale: 1.1" src="assets/impact-48v-miniapp.png" alt="–ì–∞–π–∫–æ–≤–µ—Ä—Ç">
                </div>
                <h3>–ì–ê–ô–ö–û–í–ï–†–¢–´</h3>
            </div>

        </div>
        <section class="videos-page" id="videos-page">
            <!-- Promo Section -->
            <div class="promo-section">
                <div class="promo-header">
                    <div class="promo-icon">
                        <svg width="40" height="40" viewBox="0 0 40 40" fill="none">
                            <rect x="8" y="10" width="24" height="18" rx="2" stroke="white" stroke-width="2" fill="none"/>
                            <polygon points="8,10 20,18 32,10" fill="white"/>
                            <circle cx="20" cy="19" r="3" fill="#0088cc"/>
                        </svg>
                    </div>
                    <div class="promo-content">
                        <h2>–ù–æ–≤—ã–µ –≤–∏–¥–µ–æ–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏</h2>
                        <p>–°–º–æ—Ç—Ä–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è <span class="chevron">></span></p>
                    </div>
                </div>
                <div class="promo-stats">
                    <div class="stat-item">
                        <span class="stat-number">250+</span>
                        <span class="stat-label">–í–∏–¥–µ–æ</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">50+</span>
                        <span class="stat-label">–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">24/7</span>
                        <span class="stat-label">–î–æ—Å—Ç—É–ø</span>
                    </div>
                </div>
            </div>

            <!-- Search Bar -->
            <div class="search-container">
                <div class="search-bar">
                    <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none">
                        <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
                        <path d="m21 21-4.35-4.35" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    <input type="text" placeholder="–ü–æ–∏—Å–∫ –≤–∏–¥–µ–æ..." class="search-input" id="videos-search-input">
                </div>
            </div>

            <!-- Videos Section -->
            <section id="videos-section" class="videos-section">
                <div class="section-header">
                    <h2>–í–∏–¥–µ–æ–æ–±–∑–æ—Ä—ã —ç–ª–µ–∫—Ç—Ä–æ–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞</h2>
                    <p>–ü–æ–¥–±–æ—Ä–∫–∞ –æ–±–∑–æ—Ä–æ–≤ –∏ —Ç–µ—Å—Ç–æ–≤: —à—É—Ä—É–ø–æ–≤—ë—Ä—Ç—ã, –£–®–ú, –ø–µ—Ä—Ñ–æ—Ä–∞—Ç–æ—Ä—ã, –ø–∏–ª—ã –∏ —à–ª–∏—Ñ–º–∞—à–∏–Ω—ã. –ù–∞–∂–º–∏—Ç–µ ¬´–û—Ç–∫—Ä—ã—Ç—å¬ª, —á—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ YouTube.</p>
                </div>

                <div class="video-grid">
                    <article class="video-card">
                        <div class="video-thumb" aria-hidden="true">
                            <svg viewBox="0 0 24 24" fill="none">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" opacity="0.7"/>
                                <polygon points="10 8 17 12 10 16" fill="currentColor"/>
                            </svg>
                        </div>
                        <div class="video-meta">
                            <h3>–û–±–∑–æ—Ä –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä–Ω–æ–≥–æ —à—É—Ä—É–ø–æ–≤—ë—Ä—Ç–∞ 18V: –∫—Ä—É—Ç—è—â–∏–π –º–æ–º–µ–Ω—Ç –∏ —Ç–µ—Å—Ç –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π</h3>
                            <p>–ù–∞ —á—Ç–æ —Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–∏ –≤—ã–±–æ—Ä–µ: –ø–∞—Ç—Ä–æ–Ω, —Ä–µ–¥—É–∫—Ç–æ—Ä, –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä—ã, –±–∞–ª–∞–Ω—Å –∏ —ç—Ä–≥–æ–Ω–æ–º–∏–∫–∞.</p>
                            <div class="video-actions">
                                <button class="video-open telegram-button" data-url="https://www.youtube.com/results?search_query=%D0%BE%D0%B1%D0%B7%D0%BE%D1%80+%D0%B0%D0%BA%D0%BA%D1%83%D0%BC%D1%83%D0%BB%D1%8F%D1%82%D0%BE%D1%80%D0%BD%D1%8B%D0%B9+%D1%88%D1%83%D1%80%D1%83%D0%BF%D0%BE%D0%B2%D0%B5%D1%80%D1%82+18v+%D1%82%D0%B5%D1%81%D1%82">–û—Ç–∫—Ä—ã—Ç—å</button>
                            </div>
                        </div>
                    </article>

                    <article class="video-card">
                        <div class="video-thumb" aria-hidden="true">
                            <svg viewBox="0 0 24 24" fill="none">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" opacity="0.7"/>
                                <polygon points="10 8 17 12 10 16" fill="currentColor"/>
                            </svg>
                        </div>
                        <div class="video-meta">
                            <h3>–£–®–ú (–±–æ–ª–≥–∞—Ä–∫–∞) 125 –º–º: –æ–±–∑–æ—Ä, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –≤—ã–±–æ—Ä –¥–∏—Å–∫–æ–≤</h3>
                            <p>–ö–æ–∂—É—Ö, –ø–ª–∞–≤–Ω—ã–π –ø—É—Å–∫, –æ–±–æ—Ä–æ—Ç—ã, –¥–∏—Å–∫–∏ –ø–æ –º–µ—Ç–∞–ª–ª—É/–∫–∞–º–Ω—é ‚Äî —á—Ç–æ –≤–∞–∂–Ω–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã.</p>
                            <div class="video-actions">
                                <button class="video-open telegram-button" data-url="https://www.youtube.com/results?search_query=%D0%BE%D0%B1%D0%B7%D0%BE%D1%80+%D1%83%D1%88%D0%BC+125+%D0%B1%D0%BE%D0%BB%D0%B3%D0%B0%D1%80%D0%BA%D0%B0+%D0%B1%D0%B5%D0%B7%D0%BE%D0%BF%D0%B0%D1%81%D0%BD%D0%BE%D1%81%D1%82%D1%8C+%D0%B4%D0%B8%D1%81%D0%BA%D0%B8">–û—Ç–∫—Ä—ã—Ç—å</button>
                            </div>
                        </div>
                    </article>

                    <article class="video-card">
                        <div class="video-thumb" aria-hidden="true">
                            <svg viewBox="0 0 24 24" fill="none">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" opacity="0.7"/>
                                <polygon points="10 8 17 12 10 16" fill="currentColor"/>
                            </svg>
                        </div>
                        <div class="video-meta">
                            <h3>–ü–µ—Ä—Ñ–æ—Ä–∞—Ç–æ—Ä SDS-Plus: –æ–±–∑–æ—Ä —Ä–µ–∂–∏–º–æ–≤, –±—É—Ä–æ–≤ –∏ —Ç–∏–ø–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫</h3>
                            <p>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ ¬´—Å–≤–µ—Ä–ª–µ–Ω–∏–µ/—É–¥–∞—Ä/–¥–æ–ª–±–ª–µ–Ω–∏–µ¬ª, –≤—ã–±–æ—Ä –±—É—Ä–æ–≤ –∏ —É—Ö–æ–¥ –∑–∞ –ø–∞—Ç—Ä–æ–Ω–æ–º.</p>
                            <div class="video-actions">
                                <button class="video-open telegram-button" data-url="https://www.youtube.com/results?search_query=%D0%BE%D0%B1%D0%B7%D0%BE%D1%80+%D0%BF%D0%B5%D1%80%D1%84%D0%BE%D1%80%D0%B0%D1%82%D0%BE%D1%80+sds-plus+%D1%80%D0%B5%D0%B6%D0%B8%D0%BC%D1%8B+%D0%B1%D1%83%D1%80%D1%8B">–û—Ç–∫—Ä—ã—Ç—å</button>
                            </div>
                        </div>
                    </article>

                    <article class="video-card">
                        <div class="video-thumb" aria-hidden="true">
                            <svg viewBox="0 0 24 24" fill="none">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" opacity="0.7"/>
                                <polygon points="10 8 17 12 10 16" fill="currentColor"/>
                            </svg>
                        </div>
                        <div class="video-meta">
                            <h3>–¶–∏—Ä–∫—É–ª—è—Ä–Ω–∞—è –ø–∏–ª–∞: –æ–±–∑–æ—Ä –¥–∏—Å–∫–æ–≤, –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≥–ª—É–±–∏–Ω—ã –∏ —Ä–æ–≤–Ω—ã–π —Ä–µ–∑</h3>
                            <p>–ö–∞–∫ –≤—ã–±—Ä–∞—Ç—å –¥–∏—Å–∫ –ø–æ–¥ –º–∞—Ç–µ—Ä–∏–∞–ª, –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π —É–ø–æ—Ä –∏ –∏–∑–±–µ–∂–∞—Ç—å —Å–∫–æ–ª–æ–≤.</p>
                            <div class="video-actions">
                                <button class="video-open telegram-button" data-url="https://www.youtube.com/results?search_query=%D0%BE%D0%B1%D0%B7%D0%BE%D1%80+%D1%86%D0%B8%D1%80%D0%BA%D1%83%D0%BB%D1%8F%D1%80%D0%BD%D0%B0%D1%8F+%D0%BF%D0%B8%D0%BB%D0%B0+%D0%B4%D0%B8%D1%81%D0%BA%D0%B8+%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0+%D1%80%D0%B5%D0%B7">–û—Ç–∫—Ä—ã—Ç—å</button>
                            </div>
                        </div>
                    </article>

                    <article class="video-card">
                        <div class="video-thumb" aria-hidden="true">
                            <svg viewBox="0 0 24 24" fill="none">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" opacity="0.7"/>
                                <polygon points="10 8 17 12 10 16" fill="currentColor"/>
                            </svg>
                        </div>
                        <div class="video-meta">
                            <h3>–≠–∫—Å—Ü–µ–Ω—Ç—Ä–∏–∫–æ–≤–∞—è —à–ª–∏—Ñ–º–∞—à–∏–Ω–∞: –æ–±–∑–æ—Ä, –ø—ã–ª–µ—É–¥–∞–ª–µ–Ω–∏–µ –∏ –≤—ã–±–æ—Ä –∑–µ—Ä–Ω–∞</h3>
                            <p>–ö–∞–∫ –ø–æ–¥–æ–±—Ä–∞—Ç—å –∞–±—Ä–∞–∑–∏–≤ –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å, —á—Ç–æ–±—ã –Ω–µ ¬´–∂–µ—á—å¬ª –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å.</p>
                            <div class="video-actions">
                                <button class="video-open telegram-button" data-url="https://www.youtube.com/results?search_query=%D0%BE%D0%B1%D0%B7%D0%BE%D1%80+%D1%8D%D0%BA%D1%81%D1%86%D0%B5%D0%BD%D1%82%D1%80%D0%B8%D0%BA%D0%BE%D0%B2%D0%B0%D1%8F+%D1%88%D0%BB%D0%B8%D1%84%D0%BC%D0%B0%D1%88%D0%B8%D0%BD%D0%B0+%D0%BF%D1%8B%D0%BB%D0%B5%D1%83%D0%B4%D0%B0%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5+%D0%B7%D0%B5%D1%80%D0%BD%D0%BE">–û—Ç–∫—Ä—ã—Ç—å</button>
                            </div>
                        </div>
                    </article>
                </div>
            </section>
        </section>
    </main>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <button class="nav-item active">
            <svg class="nav-icon" width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" stroke="currentColor" stroke-width="2" fill="none"/>
                <polyline points="9 22 9 12 15 12 15 22" stroke="currentColor" stroke-width="2" fill="none"/>
            </svg>
            <span>–ì–ª–∞–≤–Ω–∞—è</span>
        </button>
        <button class="nav-item">
            <svg class="nav-icon" width="24" height="24" viewBox="0 0 24 24" fill="none">
                <rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2" fill="none"/>
                <polygon points="8 3 8 21 16 12" fill="currentColor"/>
            </svg>
            <span>–í–∏–¥–µ–æ</span>
        </button>
        <button class="nav-item" id="nav-my-tools">
            <svg class="nav-icon" width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M14.7 6.3a3 3 0 0 0-4.2 4.2L3 18l3 3 7.5-7.5a3 3 0 0 0 4.2-4.2l-3 3-3-3 3-3z" stroke="currentColor" stroke-width="2" fill="none" stroke-linejoin="round" stroke-linecap="round"/>
            </svg>
            <span>–ú–æ–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</span>
        </button>
        <button class="nav-item">
            <svg class="nav-icon" width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" stroke="currentColor" stroke-width="2" fill="none"/>
            </svg>
            <span>–ß–∞—Ç —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π</span>
        </button>
        <button class="nav-item" id="nav-where-buy" data-action="where-buy" aria-label="–ì–¥–µ –∫—É–ø–∏—Ç—å?">
            <svg class="nav-icon" width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z" stroke="currentColor" stroke-width="2" fill="none"/>
                <line x1="3" y1="6" x2="21" y2="6" stroke="currentColor" stroke-width="2"/>
                <path d="M16 10a4 4 0 0 1-8 0" stroke="currentColor" stroke-width="2" fill="none"/>
            </svg>
            <span>–ì–¥–µ –∫—É–ø–∏—Ç—å?</span>
        </button>
    </nav>

    <!-- Where to buy modal -->
    <div class="modal-overlay" id="where-buy-modal" aria-hidden="true">
        <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="where-buy-title">
            <div class="modal-header">
                <h2 id="where-buy-title">–ì–¥–µ –∫—É–ø–∏—Ç—å?</h2>
            </div>
            <div class="modal-body">
                <p class="modal-lead">–ù–∞—à–∏ –º–∞–≥–∞–∑–∏–Ω—ã:</p>
                <div class="modal-list">
                    <div class="modal-item">
                        <div class="modal-item-title">–ë—Ä–∞—Ç—Å–∫, –Æ–∂–Ω–∞—è, 14–ë, —Å—Ç—Ä. 1</div>
                        <a class="modal-link" href="tel:+79247000952">üìû +7 (924) 700-09-52</a>
                    </div>
                    <div class="modal-item">
                        <div class="modal-item-title">–ë—Ä–∞—Ç—Å–∫, –ò–Ω–¥—É—Å—Ç—Ä–∏–∞–ª—å–Ω—ã–π –ø—Ä–æ–µ–∑–¥, 11</div>
                        <a class="modal-link" href="tel:+79247000952">üìû +7 (924) 700-09-52</a>
                    </div>
                    <div class="modal-item">
                        <div class="modal-item-title">–£—Å—Ç—å-–ò–ª–∏–º—Å–∫, –ø—Ä–æ—Å–ø–µ–∫—Ç –ú–∏—Ä–∞, 41</div>
                        <a class="modal-link" href="tel:+79247177569">üìû +7 (924) 717-75-69</a>
                    </div>
                    <div class="modal-item">
                        <div class="modal-item-title">–ù–∏–∂–Ω–µ—É–¥–∏–Ω—Å–∫, –ú–∞—Å–ª–æ–≤—Å–∫–æ–≥–æ, 43</div>
                        <a class="modal-link" href="tel:+79247001058">üìû +7 (924) 700-10-58</a>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <a class="telegram-button modal-action" href="https://—Ç–µ–ø–ª—ã–π–¥–æ–º38.—Ä—Ñ/–±—Ä–∞—Ç—Å–∫/?ysclid=mki3mdiiw2874168637" target="_blank" rel="noopener">üåê –û—Ç–∫—Ä—ã—Ç—å –º–∞–≥–∞–∑–∏–Ω</a>
            </div>
        </div>
    </div>

    <!-- Drill catalog modal -->
    <div class="modal-overlay" id="drill-catalog-modal" aria-hidden="true">
        <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="drill-catalog-title">
            <div class="modal-header">
                <h2 id="drill-catalog-title">–ö–∞—Ç–∞–ª–æ–≥: –¥—Ä–µ–ª–∏ –∏ —à—É—Ä—É–ø–æ–≤–µ—Ä—Ç—ã</h2>
                <button class="modal-close" type="button" aria-label="–ó–∞–∫—Ä—ã—Ç—å">√ó</button>
            </div>
            <div class="modal-body">
                <div class="content-grid modal-grid">
                    <div class="grid-item">
                        <div class="item-icon">
                            <img style="--img-scale: 1.15" src="https://storage.yandexcloud.net/miniappp/assets/drill.webp" alt="–î—Ä–µ–ª—å –∏ —à—É—Ä—É–ø–æ–≤–µ—Ä—Ç">
                        </div>
                    </div>
                </div>
                <p class="modal-lead">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –º–æ–¥–µ–ª–∏:</p>
                <div class="modal-list">
                    <div class="modal-item">
                        <div class="modal-item-title">APEXWOLT 48–í</div>
                        <a class="modal-link" href="https://—Ç–µ–ø–ª—ã–π–¥–æ–º38.—Ä—Ñ/–±—Ä–∞—Ç—Å–∫/?ysclid=mki3mdiiw2874168637" target="_blank" rel="noopener">üåê –°–º–æ—Ç—Ä–µ—Ç—å –≤ –∫–∞—Ç–∞–ª–æ–≥–µ</a>
                    </div>
                    <div class="modal-item">
                        <div class="modal-item-title">APEXWOLT 18–í</div>
                        <a class="modal-link" href="https://—Ç–µ–ø–ª—ã–π–¥–æ–º38.—Ä—Ñ/–±—Ä–∞—Ç—Å–∫/?ysclid=mki3mdiiw2874168637" target="_blank" rel="noopener">üåê –°–º–æ—Ç—Ä–µ—Ç—å –≤ –∫–∞—Ç–∞–ª–æ–≥–µ</a>
                    </div>
                    <div class="modal-item">
                        <div class="modal-item-title">–ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ –º–æ–¥–µ–ª–∏ –¥–ª—è –¥–æ–º–∞</div>
                        <a class="modal-link" href="https://—Ç–µ–ø–ª—ã–π–¥–æ–º38.—Ä—Ñ/–±—Ä–∞—Ç—Å–∫/?ysclid=mki3mdiiw2874168637" target="_blank" rel="noopener">üåê –°–º–æ—Ç—Ä–µ—Ç—å –≤ –∫–∞—Ç–∞–ª–æ–≥–µ</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
// ============================================
// Telegram WebApp API Integration
// ============================================

// Check if running in Telegram
const isTelegram = window.Telegram && window.Telegram.WebApp;
let tg = null;

if (isTelegram) {
    tg = window.Telegram.WebApp;
    
    // Initialize Telegram WebApp
    if (tg.ready) {
        tg.ready();
    }
    if (tg.expand) {
        tg.expand(); // Expand to full height
    }
    
    // Enable closing confirmation (if supported)
    if (tg.enableClosingConfirmation) {
        tg.enableClosingConfirmation();
    }
    
    // Set up theme colors based on Telegram theme
    try {
        applyTelegramTheme();
    } catch (e) {
        console.warn('applyTelegramTheme error:', e);
    }
    
    // Listen to theme changes
    if (tg.onEvent) {
        tg.onEvent('themeChanged', applyTelegramTheme);
    }
    
    // Listen to viewport changes
    if (tg.onEvent) {
        tg.onEvent('viewportChanged', handleViewportChange);
    }
    
    // Set up back button
    try {
        setupBackButton();
    } catch (e) {
        console.warn('setupBackButton error:', e);
    }
} else {
    // Fallback for development/testing outside Telegram
    console.warn('Running outside Telegram. Some features may not work.');
    tg = {
        close: () => console.log('Close app'),
        showAlert: (msg) => alert(msg),
        showPopup: (options, callback) => {
            const result = confirm(options.message || '');
            if (callback) callback(result ? 'ok' : 'cancel');
        },
        HapticFeedback: {
            impactOccurred: () => {},
            notificationOccurred: () => {}
        },
        platform: 'unknown',
        initDataUnsafe: {},
        version: '6.0'
    };
}

// ============================================
// Theme Management
// ============================================

function applyTelegramTheme() {
    if (!tg) return;
    
    const colorScheme = tg.colorScheme || 'light';
    const themeParams = tg.themeParams || {};
    
    // Get colors from Telegram theme or use defaults
    const bgColor = themeParams.bg_color || (colorScheme === 'dark' ? '#1a1a1a' : '#ffffff');
    const secondaryBgColor = themeParams.secondary_bg_color || (colorScheme === 'dark' ? '#2a2a2a' : '#f0f0f0');
    const textColor = themeParams.text_color || (colorScheme === 'dark' ? '#ffffff' : '#000000');
    const hintColor = themeParams.hint_color || (colorScheme === 'dark' ? '#888888' : '#999999');
    const linkColor = themeParams.link_color || '#0088cc';
    const buttonColor = themeParams.button_color || '#0088cc';
    const buttonTextColor = themeParams.button_text_color || '#ffffff';
    
    // Apply colors to Telegram
    tg.setHeaderColor(secondaryBgColor);
    tg.setBackgroundColor(bgColor);
    
    // Apply CSS variables
    document.documentElement.style.setProperty('--tg-theme-bg-color', bgColor);
    document.documentElement.style.setProperty('--tg-theme-secondary-bg-color', secondaryBgColor);
    document.documentElement.style.setProperty('--tg-theme-text-color', textColor);
    document.documentElement.style.setProperty('--tg-theme-hint-color', hintColor);
    document.documentElement.style.setProperty('--tg-theme-link-color', linkColor);
    document.documentElement.style.setProperty('--tg-theme-button-color', buttonColor);
    document.documentElement.style.setProperty('--tg-theme-button-text-color', buttonTextColor);
    
    // Update body class for theme
    document.body.classList.toggle('theme-dark', colorScheme === 'dark');
    document.body.classList.toggle('theme-light', colorScheme === 'light');
}

// ============================================
// Viewport Management
// ============================================

function handleViewportChange(event) {
    if (!tg) return;
    
    const viewportHeight = tg.viewportHeight || window.innerHeight;
    const viewportStableHeight = tg.viewportStableHeight || viewportHeight;
    
    // Adjust layout for viewport changes
    document.documentElement.style.setProperty('--viewport-height', `${viewportHeight}px`);
    document.documentElement.style.setProperty('--viewport-stable-height', `${viewportStableHeight}px`);
    
    // Handle safe area insets
    const safeArea = tg.safeAreaInsets || {};
    if (safeArea.bottom) {
        document.documentElement.style.setProperty('--safe-area-bottom', `${safeArea.bottom}px`);
    }
    if (safeArea.top) {
        document.documentElement.style.setProperty('--safe-area-top', `${safeArea.top}px`);
    }
}

// ============================================
// Back Button Management
// ============================================

let backButtonHistory = [];
const enableNativeBackButton = false;

function setupBackButton() {
    if (!tg || !tg.BackButton) return;
    
    const backButton = tg.BackButton;
    
    if (!enableNativeBackButton) {
        backButton.hide();
        return;
    }
    
    // Show back button if there's history
    backButton.show();
    backButton.onClick(() => {
        if (backButtonHistory.length > 0) {
            const previousPage = backButtonHistory.pop();
            navigateToPage(previousPage);
        } else {
            tg.close();
        }
    });
}

function showBackButton() {
    if (!enableNativeBackButton) return;
    if (tg && tg.BackButton) {
        tg.BackButton.show();
    }
}

function hideBackButton() {
    if (!enableNativeBackButton) return;
    if (tg && tg.BackButton) {
        tg.BackButton.hide();
    }
}

function addToHistory(page) {
    backButtonHistory.push(page);
    showBackButton();
}

// ============================================
// User Data Management
// ============================================

function getUserData() {
    if (!tg || !tg.initDataUnsafe) return null;
    
    const user = tg.initDataUnsafe.user;
    if (!user) return null;
    
    return {
        id: user.id,
        firstName: user.first_name,
        lastName: user.last_name,
        username: user.username,
        languageCode: user.language_code,
        isPremium: user.is_premium || false,
        photoUrl: user.photo_url
    };
}

function getInitData() {
    if (!tg) return null;
    return tg.initData || null;
}

function getInitDataUnsafe() {
    if (!tg) return null;
    return tg.initDataUnsafe || {};
}

// ============================================
// UI Event Handlers
// ============================================

// Close button handler
// Menu button handler
const menuBtn = document.querySelector('.menu-btn');
if (menuBtn) {
    menuBtn.addEventListener('click', () => {
        hapticFeedback('impact');
        if (tg && tg.showPopup) {
            tg.showPopup({
                title: '–ú–µ–Ω—é',
                message: '–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ',
                buttons: [
                    { id: 'history', type: 'default', text: '–ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤' },
                    { id: 'downloads', type: 'default', text: '–°–∫–∞—á–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ' },
                    { id: 'settings', type: 'default', text: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏' },
                    { id: 'about', type: 'default', text: '–û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏' }
                ]
            }, (buttonId) => {
                handleMenuAction(buttonId);
            });
        }
    });
}

function handleMenuAction(buttonId) {
    hapticFeedback('notification');
    
    switch(buttonId) {
        case 'history':
            showHistoryPage();
            break;
        case 'downloads':
            showDownloadsPage();
            break;
        case 'settings':
            showSettingsPage();
            break;
        case 'about':
            showAboutDialog();
            break;
    }
}

// Promo section click handler
const promoContent = document.querySelector('.promo-content');
if (promoContent) {
    promoContent.addEventListener('click', () => {
        hapticFeedback('impact');
        trackUserAction('promo_clicked');
        navigateToPage('–≤–∏–¥–µ–æ');
    });
}

// Grid item click handlers - –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
document.querySelectorAll('.grid-item').forEach((item, index) => {
    item.addEventListener('click', () => {
        hapticFeedback('impact');
        const externalUrl = item.dataset.url;
        if (externalUrl) {
            trackUserAction('category_external_opened', { url: externalUrl });
            if (tg && typeof tg.openLink === 'function') {
                tg.openLink(externalUrl);
            } else {
                window.open(externalUrl, '_blank', 'noopener,noreferrer');
            }
            return;
        }

        const categories = [
            '–î–†–ï–õ–ò –ò –®–£–†–£–ü–û–í–ï–†–¢–´',
            '–ë–û–õ–ì–ê–†–ö–ò (–£–®–ú)',
            '–õ–û–ë–ó–ò–ö–ò',
            '–®–õ–ò–§–ú–ê–®–ò–ù–´'
        ];
        
        const categoryId = index + 1;
        const categoryName = categories[index];
        
        trackUserAction('category_opened', { category: categoryName, categoryId });
        addToHistory('home');
        openCategory(categoryId, categoryName);
    });
});

// Bottom navigation handlers
document.querySelectorAll('.nav-item').forEach((item, index) => {
    item.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        
        hapticFeedback('impact');
        
        // Remove active class from all items
        document.querySelectorAll('.nav-item').forEach(nav => {
            nav.classList.remove('active');
        });
        
        // Add active class to clicked item
        item.classList.add('active');
        
        const navLabels = [
            '–ì–ª–∞–≤–Ω–∞—è',
            '–í–∏–¥–µ–æ',
            '–ú–æ–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã',
            '–ß–∞—Ç —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π',
            '–ì–¥–µ –∫—É–ø–∏—Ç—å?'
        ];
        
        trackUserAction('navigation', { page: navLabels[index] });
        
        // Explicit handling for "–ì–¥–µ –∫—É–ø–∏—Ç—å?" button
        if (item.dataset.action === 'where-buy' || index === 4 || navLabels[index] === '–ì–¥–µ –∫—É–ø–∏—Ç—å?') {
            console.log('–ö–Ω–æ–ø–∫–∞ "–ì–¥–µ –∫—É–ø–∏—Ç—å?" –Ω–∞–∂–∞—Ç–∞');
            setActiveNavIndex(4);
            showWhereToBuy();
        } else {
            navigateToPage(navLabels[index].toLowerCase());
        }
    });
});

// Dedicated handler to ensure "–ì–¥–µ –∫—É–ø–∏—Ç—å?" always opens (even if index order changes)
const whereBuyNav = document.getElementById('nav-where-buy');
if (whereBuyNav) {
    whereBuyNav.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        hapticFeedback('impact');
        setActiveNavIndex(4);
        showWhereToBuy();
    });
    whereBuyNav.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            whereBuyNav.click();
        }
    });
}

// Dedicated handler for "–ú–æ–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã" button
const myToolsNav = document.getElementById('nav-my-tools');
if (myToolsNav) {
    myToolsNav.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        hapticFeedback('impact');
        setActiveNavIndex(2);
        showMyToolsPage();
    });
}

// Catalog links handler (opens through Telegram API)
document.addEventListener('click', (e) => {
    const catalogLink = e.target.closest('.catalog-link');
    if (catalogLink) {
        e.preventDefault();
        e.stopPropagation();
        hapticFeedback('impact');
        const url = catalogLink.getAttribute('data-url') || catalogLink.getAttribute('href');
        if (url) {
            trackUserAction('catalog_link_clicked', { url });
            if (tg && typeof tg.openLink === 'function') {
                tg.openLink(url);
            } else {
                window.open(url, '_blank', 'noopener,noreferrer');
            }
        }
    }
});

// Search functionality for tools page
const toolsSearchInput = document.getElementById('tools-search-input');
if (toolsSearchInput) {
    let searchTimeout;
    
    toolsSearchInput.addEventListener('input', (e) => {
        clearTimeout(searchTimeout);
        const query = e.target.value.trim();
        
        if (query.length > 0) {
            searchTimeout = setTimeout(() => {
                trackUserAction('search', { query: query, page: 'tools' });
                // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∏—Å–∫ –ø–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
            }, 300);
        }
    });
}

// Search functionality for videos page
const videosSearchInput = document.getElementById('videos-search-input');
if (videosSearchInput) {
    let searchTimeout;
    
    videosSearchInput.addEventListener('input', (e) => {
        clearTimeout(searchTimeout);
        const query = e.target.value.trim();
        
        if (query.length > 0) {
            searchTimeout = setTimeout(() => {
                trackUserAction('search', { query: query, page: 'videos' });
                performSearch(query);
            }, 300);
        } else {
            clearSearchResults();
        }
    });
    
    // –¢–∞–∫–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—á–∏—Å—Ç–∫—É –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ/–ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞
    videosSearchInput.addEventListener('focus', () => {
        const query = videosSearchInput.value.trim();
        if (query.length > 0) {
            performSearch(query);
        }
    });
}

const toolsBackBtn = document.getElementById('tools-back');
if (toolsBackBtn) {
    toolsBackBtn.addEventListener('click', () => {
        showHomePage();
    });
}

const catalogBackBtn = document.getElementById('catalog-back');
if (catalogBackBtn) {
    catalogBackBtn.addEventListener('click', () => {
        showHomePage();
    });
}

const refreshPurchasesBtn = document.getElementById('refresh-purchases');
if (refreshPurchasesBtn) {
    // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –∫–Ω–æ–ø–∫–∞ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–∞
    refreshPurchasesBtn.style.pointerEvents = 'auto';
    refreshPurchasesBtn.style.cursor = 'pointer';
    refreshPurchasesBtn.disabled = false;
    
    refreshPurchasesBtn.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        refreshPurchasedTools();
    });
    
    // –¢–∞–∫–∂–µ –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è touch —Å–æ–±—ã—Ç–∏–π
    refreshPurchasesBtn.addEventListener('touchstart', (e) => {
        e.preventDefault();
        refreshPurchasedTools();
    });
}

// –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ì–¥–µ –∫—É–ø–∏—Ç—å?"
document.addEventListener('DOMContentLoaded', () => {
    const navItems = document.querySelectorAll('.nav-item');
    navItems.forEach((item, index) => {
        const span = item.querySelector('span');
        if (span && span.textContent.trim() === '–ì–¥–µ –∫—É–ø–∏—Ç—å?') {
            // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –∫–Ω–æ–ø–∫–∞ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–∞
            item.style.cursor = 'pointer';
            item.style.pointerEvents = 'auto';
            item.setAttribute('role', 'button');
            item.setAttribute('tabindex', '0');
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (–¥–ª—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏)
            item.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    item.click();
                }
            });
            
            console.log('–ö–Ω–æ–ø–∫–∞ "–ì–¥–µ –∫—É–ø–∏—Ç—å?" –Ω–∞–π–¥–µ–Ω–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞');
        }
    });
});

// Where to buy modal handlers
const whereBuyModal = document.getElementById('where-buy-modal');
if (whereBuyModal) {
    const closeBtn = whereBuyModal.querySelector('.modal-close');
    if (closeBtn) {
        closeBtn.addEventListener('click', closeWhereBuyModal);
    }

    whereBuyModal.querySelectorAll('.modal-link').forEach((link) => {
        link.addEventListener('click', () => {
            const phone = link.getAttribute('href');
            if (!phone) return;
            openPhoneDialer(phone);
        });
    });

    whereBuyModal.addEventListener('click', (e) => {
        if (e.target === whereBuyModal) {
            closeWhereBuyModal();
        }
    });

    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            closeWhereBuyModal();
        }
    });
}

const drillCatalogModal = document.getElementById('drill-catalog-modal');
if (drillCatalogModal) {
    const closeBtn = drillCatalogModal.querySelector('.modal-close');
    if (closeBtn) {
        closeBtn.addEventListener('click', closeDrillCatalogModal);
    }
    drillCatalogModal.addEventListener('click', (e) => {
        if (e.target === drillCatalogModal) {
            closeDrillCatalogModal();
        }
    });
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            closeDrillCatalogModal();
        }
    });
}

// ============================================
// Navigation Functions
// ============================================

function navigateToPage(page) {
    console.log('Navigating to:', page);
    
    switch(page) {
        case 'home':
        case '–≥–ª–∞–≤–Ω–∞—è':
            showHomePage();
            break;
        case '–≤–∏–¥–µ–æ':
            showVideosPage();
            break;
        case '–º–æ–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã':
            showMyToolsPage();
            break;
        case '—á–∞—Ç —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π':
            showSupportChat();
            break;
        case '–≥–¥–µ –∫—É–ø–∏—Ç—å?':
        case '–≥–¥–µ –∫—É–ø–∏—Ç—å':
            console.log('Calling showWhereToBuy()');
            showWhereToBuy();
            break;
        default:
            console.warn('Unknown page:', page);
    }
}

function setActiveNavIndex(activeIndex) {
    const items = document.querySelectorAll('.nav-item');
    items.forEach((nav, i) => {
        nav.classList.toggle('active', i === activeIndex);
    });
}

function setHeader(title, subtitle) {
    const titleEl = document.querySelector('.header-title h1');
    const subtitleEl = document.querySelector('.header-title .subtitle');
    if (titleEl) titleEl.textContent = title;
    if (subtitleEl) subtitleEl.textContent = subtitle;
}

function showHomePage() {
    hideBackButton();
    setHeader('–≠–ª–µ–∫—Ç—Ä–æ–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã', '');
    setActiveNavIndex(0);
    window.scrollTo({ top: 0, behavior: 'smooth' });
    toggleCatalogPage(false);
    toggleToolsPage(false);
    toggleMyToolsPage(false);
    toggleVideosPage(false);
}

function showVideosPage() {
    addToHistory('home');
    setHeader('–í–∏–¥–µ–æ–∏–Ω—Ç—Ä—É–∫—Ü–∏–∏', '');
    setActiveNavIndex(1);
    toggleCatalogPage(false);
    toggleToolsPage(false);
    toggleMyToolsPage(false);
    toggleVideosPage(true);
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function showSupportChat() {
    addToHistory('home');
    hapticFeedback('impact');
    toggleCatalogPage(false);
    toggleToolsPage(false);
    toggleMyToolsPage(false);
    toggleVideosPage(false);
    
    if (tg && tg.openTelegramLink) {
        // –û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —á–µ—Ä–µ–∑ Telegram
        tg.openTelegramLink('https://t.me/georgyitikhonov');
    } else if (tg && tg.openLink) {
        // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± –æ—Ç–∫—Ä—ã—Ç–∏—è —Å—Å—ã–ª–∫–∏
        tg.openLink('https://t.me/georgyitikhonov');
    } else {
        // Fallback –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–Ω–µ Telegram
        window.open('https://t.me/georgyitikhonov', '_blank');
        if (tg && tg.showAlert) {
            tg.showAlert('–ß–∞—Ç —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π\n\n–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Å—Å—ã–ª–∫—É –¥–ª—è —Å–≤—è–∑–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:\n\nüí¨ @georgyitikhonov');
        }
    }
}

function toggleToolsPage(isVisible) {
    const toolsPage = document.getElementById('tools-page');
    const mainContent = document.querySelector('.main-content');
    if (!toolsPage || !mainContent) return;
    toolsPage.classList.toggle('active', isVisible);
    const sections = Array.from(mainContent.children).filter((child) => child.id !== 'tools-page');
    sections.forEach((section) => {
        section.style.display = isVisible ? 'none' : '';
    });
}

function showCatalogPage() {
    setHeader('–ö–∞—Ç–∞–ª–æ–≥: –î—Ä–µ–ª–∏ –∏ —à—É—Ä—É–ø–æ–≤–µ—Ä—Ç—ã', '');
    setActiveNavIndex(0);
    toggleCatalogPage(true);
    toggleMyToolsPage(false);
    toggleToolsPage(false);
    toggleVideosPage(false);
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function toggleCatalogPage(isVisible) {
    const catalogPage = document.getElementById('catalog-page');
    const mainContent = document.querySelector('.main-content');
    if (!catalogPage || !mainContent) return;
    catalogPage.classList.toggle('active', isVisible);
    
    // –°–∫—Ä—ã–≤–∞–µ–º/–ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥—Ä—É–≥–∏–µ —Å–µ–∫—Ü–∏–∏
    const contentGrid = mainContent.querySelector('.content-grid');
    if (contentGrid) {
        contentGrid.style.display = isVisible ? 'none' : '';
    }
    
    const sections = Array.from(mainContent.children).filter((child) => 
        child.id !== 'catalog-page' && 
        child.id !== 'tools-page' && 
        child.id !== 'my-tools-page' && 
        child.id !== 'videos-page' &&
        !child.classList.contains('content-grid')
    );
    sections.forEach((section) => {
        section.style.display = isVisible ? 'none' : '';
    });
}

function showToolsPage() {
    setHeader('–î—Ä–µ–ª–∏ –∏ —à—É—Ä—É–ø–æ–≤–µ—Ä—Ç—ã', '–∫–∞—Ç–∞–ª–æ–≥ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏');
    setActiveNavIndex(2);
    toggleCatalogPage(false);
    toggleMyToolsPage(false);
    toggleToolsPage(true);
    toggleVideosPage(false);
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function showMyToolsPage() {
    setHeader('–ú–æ–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã', '–∫—É–ø–ª–µ–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã');
    setActiveNavIndex(2);
    toggleCatalogPage(false);
    toggleMyToolsPage(true);
    toggleToolsPage(false);
    toggleVideosPage(false);
    renderPurchasedTools();
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function toggleMyToolsPage(isVisible) {
    const myToolsPage = document.getElementById('my-tools-page');
    const mainContent = document.querySelector('.main-content');
    if (!myToolsPage || !mainContent) return;
    myToolsPage.classList.toggle('active', isVisible);
    
    // –°–∫—Ä—ã–≤–∞–µ–º/–ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥—Ä—É–≥–∏–µ —Å–µ–∫—Ü–∏–∏
    const contentGrid = mainContent.querySelector('.content-grid');
    if (contentGrid) {
        contentGrid.style.display = isVisible ? 'none' : '';
    }
    
    const sections = Array.from(mainContent.children).filter((child) => 
        child.id !== 'my-tools-page' && 
        child.id !== 'catalog-page' &&
        child.id !== 'tools-page' && 
        child.id !== 'videos-page' &&
        !child.classList.contains('content-grid')
    );
    sections.forEach((section) => {
        section.style.display = isVisible ? 'none' : '';
    });
    
    // –Ø–≤–Ω–æ —Å–∫—Ä—ã–≤–∞–µ–º –∫–∞—Ç–∞–ª–æ–≥, –µ—Å–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º "–ú–æ–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã"
    if (isVisible) {
        const catalogPage = document.getElementById('catalog-page');
        if (catalogPage) {
            catalogPage.classList.remove('active');
        }
    }
}

function toggleVideosPage(isVisible) {
    const videosPage = document.getElementById('videos-page');
    const mainContent = document.querySelector('.main-content');
    if (!videosPage || !mainContent) return;
    videosPage.classList.toggle('active', isVisible);
    const sections = Array.from(mainContent.children).filter((child) => child.id !== 'videos-page');
    sections.forEach((section) => {
        section.style.display = isVisible ? 'none' : '';
    });
}

function openWhereBuyModal() {
    const modal = document.getElementById('where-buy-modal');
    if (!modal) return false;
    modal.classList.add('open');
    modal.setAttribute('aria-hidden', 'false');
    return true;
}

function closeWhereBuyModal() {
    const modal = document.getElementById('where-buy-modal');
    if (!modal) return;
    modal.classList.remove('open');
    modal.setAttribute('aria-hidden', 'true');
}

function openDrillCatalogModal() {
    const modal = document.getElementById('drill-catalog-modal');
    if (!modal) return false;
    modal.classList.add('open');
    modal.setAttribute('aria-hidden', 'false');
    return true;
}

function closeDrillCatalogModal() {
    const modal = document.getElementById('drill-catalog-modal');
    if (!modal) return;
    modal.classList.remove('open');
    modal.setAttribute('aria-hidden', 'true');
}

function showWhereToBuy() {
    console.log('showWhereToBuy called', { tg: !!tg, hasShowPopup: !!(tg && tg.showPopup) });
    
    try {
        addToHistory('home');
    } catch(e) {
        console.warn('addToHistory error:', e);
    }
    
    try {
        hapticFeedback('impact');
    } catch(e) {
        console.warn('hapticFeedback error:', e);
    }

    if (openWhereBuyModal()) {
        return;
    }
    
    const shopUrl = 'https://—Ç–µ–ø–ª—ã–π–¥–æ–º38.—Ä—Ñ/–±—Ä–∞—Ç—Å–∫/?ysclid=mki3mdiiw2874168637';
    const message = 'üè™ –ù–∞—à–∏ –º–∞–≥–∞–∑–∏–Ω—ã:\n\nüìç –≥. –ë—Ä–∞—Ç—Å–∫, –Æ–∂–Ω–∞—è, 14–ë, —Å—Ç—Ä–æ–µ–Ω–∏–µ 1\nüìû +7 (924) 700-09-52\n\nüìç –≥. –ë—Ä–∞—Ç—Å–∫, –ò–Ω–¥—É—Å—Ç—Ä–∏–∞–ª—å–Ω—ã–π –ø—Ä–æ–µ–∑–¥, 11\nüìû +7 (924) 700-09-52\n\nüìç –≥. –£—Å—Ç—å-–ò–ª–∏–º—Å–∫, –ø—Ä–æ—Å–ø–µ–∫—Ç –ú–∏—Ä–∞, 41\nüìû +7 (924) 717-75-69\n\nüìç –≥. –ù–∏–∂–Ω–µ—É–¥–∏–Ω—Å–∫, –ú–∞—Å–ª–æ–≤—Å–∫–æ–≥–æ, 43\nüìû +7 (924) 700-10-58\n\nüåê –û–Ω–ª–∞–π–Ω –º–∞–≥–∞–∑–∏–Ω';
    
    // –ü–æ–ø—ã—Ç–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å showPopup (Telegram WebApp API)
    if (tg && typeof tg.showPopup === 'function') {
        try {
            tg.showPopup({
                title: '–ì–¥–µ –∫—É–ø–∏—Ç—å?',
                message: message,
                buttons: [
                    { id: 'open_shop', type: 'default', text: 'üåê –û—Ç–∫—Ä—ã—Ç—å –º–∞–≥–∞–∑–∏–Ω' },
                    { id: 'call_bratsk1', type: 'default', text: 'üìû –ë—Ä–∞—Ç—Å–∫ (–Æ–∂–Ω–∞—è)' },
                    { id: 'call_bratsk2', type: 'default', text: 'üìû –ë—Ä–∞—Ç—Å–∫ (–ò–Ω–¥—É—Å—Ç—Ä.)' },
                    { id: 'call_ust_ilimsk', type: 'default', text: 'üìû –£—Å—Ç—å-–ò–ª–∏–º—Å–∫' },
                    { id: 'call_nizhneudinsk', type: 'default', text: 'üìû –ù–∏–∂–Ω–µ—É–¥–∏–Ω—Å–∫' }
                ]
            }, (buttonId) => {
                console.log('Popup button clicked:', buttonId);
                if (!buttonId || buttonId === 'cancel') return;
                
                if (buttonId === 'open_shop') {
                    if (tg && typeof tg.openLink === 'function') {
                        tg.openLink(shopUrl);
                    } else {
                        window.open(shopUrl, '_blank');
                    }
                } else if (buttonId === 'call_bratsk1') {
                    openPhoneDialer('tel:+79247000952');
                } else if (buttonId === 'call_bratsk2') {
                    openPhoneDialer('tel:+79247000952');
                } else if (buttonId === 'call_ust_ilimsk') {
                    openPhoneDialer('tel:+79247177569');
                } else if (buttonId === 'call_nizhneudinsk') {
                    openPhoneDialer('tel:+79247001058');
                }
            });
            return;
        } catch (e) {
            console.error('showPopup failed:', e);
        }
    }
    
    // Fallback 1: –∏—Å–ø–æ–ª—å–∑—É–µ–º showAlert —Å callback
    if (tg && typeof tg.showAlert === 'function') {
        const alertMessage = '–ì–¥–µ –∫—É–ø–∏—Ç—å?\n\n' + message + '\n\nüåê –û–Ω–ª–∞–π–Ω: ' + shopUrl;
        tg.showAlert(alertMessage, () => {
            // –ü–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è alert –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –æ—Ç–∫—Ä—ã—Ç—å –º–∞–≥–∞–∑–∏–Ω
            if (tg && typeof tg.showConfirm === 'function') {
                tg.showConfirm('–û—Ç–∫—Ä—ã—Ç—å –æ–Ω–ª–∞–π–Ω –º–∞–≥–∞–∑–∏–Ω?', (confirmed) => {
                    if (confirmed) {
                        if (tg && typeof tg.openLink === 'function') {
                            tg.openLink(shopUrl);
                        } else {
                            window.open(shopUrl, '_blank');
                        }
                    }
                });
            } else {
                // –ï—Å–ª–∏ showConfirm –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ø—Ä–æ—Å—Ç–æ –æ—Ç–∫—Ä—ã–≤–∞–µ–º
                if (tg && typeof tg.openLink === 'function') {
                    tg.openLink(shopUrl);
                } else {
                    window.open(shopUrl, '_blank');
                }
            }
        });
        return;
    }
    
    // Fallback 2: –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–Ω–µ Telegram
    const fullMessage = '–ì–¥–µ –∫—É–ø–∏—Ç—å?\n\n' + message + '\n\nüåê –û–Ω–ª–∞–π–Ω: ' + shopUrl + '\n\n–û—Ç–∫—Ä—ã—Ç—å –º–∞–≥–∞–∑–∏–Ω?';
    const openShop = confirm(fullMessage);
    if (openShop) {
        window.open(shopUrl, '_blank');
    }
}

function showHistoryPage() {
    addToHistory('home');
    if (tg && tg.showAlert) {
        tg.showAlert('–ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤');
    }
}

function openPhoneDialer(phone) {
    if (!phone) return;
    const normalizedPhone = phone.startsWith('tel:') ? phone : `tel:${phone}`;
    const rawPhone = normalizedPhone.replace(/^tel:/, '');
    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;

    if (tg && typeof tg.openLink === 'function') {
        try {
            tg.openLink(normalizedPhone, { try_instant_view: false });
        } catch (e) {
            console.warn('tg.openLink failed:', e);
        }
    }

    if (isIOS) {
        const telPrompt = `telprompt:${rawPhone}`;
        try {
            window.location.href = telPrompt;
        } catch (e) {
            console.warn('telprompt failed:', e);
        }
        setTimeout(() => {
            window.location.href = normalizedPhone;
        }, 200);
        return;
    }

    const tempLink = document.createElement('a');
    tempLink.href = normalizedPhone;
    tempLink.style.display = 'none';
    document.body.appendChild(tempLink);
    tempLink.click();
    tempLink.remove();
    try {
        window.open(normalizedPhone, '_self');
    } catch (e) {
        console.warn('window.open failed:', e);
    }
    window.location.href = normalizedPhone;
    document.location = normalizedPhone;
}

function showDownloadsPage() {
    addToHistory('home');
    if (tg && tg.showAlert) {
        tg.showAlert('–°–∫–∞—á–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ');
    }
}

function showSettingsPage() {
    addToHistory('home');
    if (tg && tg.showAlert) {
        tg.showAlert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è');
    }
}

function showAboutDialog() {
    if (tg && tg.showAlert) {
        tg.showAlert('–í–∏–¥–µ–æ–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —ç–ª–µ–∫—Ç—Ä–æ–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É\n\n–í–µ—Ä—Å–∏—è 1.0\n\n–û–±—É—á–∞—é—â–∏–µ –≤–∏–¥–µ–æ –ø–æ —Ä–∞–±–æ—Ç–µ —Å —ç–ª–µ–∫—Ç—Ä–æ–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º');
    }
}

function openCategory(categoryId, categoryName) {
    if (categoryId === 1) {
        showCatalogPage();
        return;
    }
    if (tg && tg.showAlert) {
        tg.showAlert(`–û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é: ${categoryName}`);
    }
}

// ============================================
// Search Functions
// ============================================

function performSearch(query) {
    if (!query || query.trim().length === 0) {
        clearSearchResults();
        return;
    }
    
    const searchQuery = query.toLowerCase().trim();
    const videoGrid = document.querySelector('#videos-section .video-grid');
    const videoCards = document.querySelectorAll('#videos-section .video-card');
    
    if (!videoGrid || !videoCards.length) {
        console.warn('Video grid or cards not found');
        return;
    }
    
    let visibleCount = 0;
    
    videoCards.forEach(card => {
        const titleElement = card.querySelector('.video-meta h3');
        const descriptionElement = card.querySelector('.video-meta p');
        
        if (!titleElement) return;
        
        const title = titleElement.textContent.toLowerCase();
        const description = descriptionElement ? descriptionElement.textContent.toLowerCase() : '';
        
        // –ü–æ–∏—Å–∫ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏–∏
        const searchWords = searchQuery.split(/\s+/).filter(word => word.length > 0);
        const matchesTitle = searchWords.some(word => title.includes(word));
        const matchesDescription = searchWords.some(word => description.includes(word));
        const matchesFullTitle = title.includes(searchQuery);
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∏–¥–µ–æ, –µ—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏, –æ–ø–∏—Å–∞–Ω–∏–∏ –∏–ª–∏ –ø–æ–ª–Ω–æ–º –Ω–∞–∑–≤–∞–Ω–∏–∏
        if (matchesTitle || matchesDescription || matchesFullTitle) {
            card.style.display = '';
            visibleCount++;
        } else {
            card.style.display = 'none';
        }
    });
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ, –µ—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
    const videosSection = document.getElementById('videos-section');
    let noResultsMessage = videosSection.querySelector('.no-results-message');
    
    if (visibleCount === 0) {
        if (!noResultsMessage) {
            noResultsMessage = document.createElement('div');
            noResultsMessage.className = 'no-results-message';
            noResultsMessage.style.cssText = 'text-align: center; padding: 40px 20px; color: var(--text-secondary);';
            noResultsMessage.innerHTML = `
                <svg width="64" height="64" viewBox="0 0 24 24" fill="none" style="margin-bottom: 16px; opacity: 0.5;">
                    <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
                    <path d="m21 21-4.35-4.35" stroke="currentColor" stroke-width="2"/>
                </svg>
                <h3 style="font-size: 16px; font-weight: 700; color: var(--text-primary); margin-bottom: 8px;">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
                <p style="font-size: 14px; color: var(--text-secondary);">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞</p>
            `;
            videoGrid.parentNode.insertBefore(noResultsMessage, videoGrid.nextSibling);
        }
        noResultsMessage.style.display = 'block';
    } else {
        if (noResultsMessage) {
            noResultsMessage.style.display = 'none';
        }
    }
    
    console.log(`Search completed: ${visibleCount} videos found for "${query}"`);
}

function clearSearchResults() {
    const videoCards = document.querySelectorAll('#videos-section .video-card');
    const noResultsMessage = document.querySelector('#videos-section .no-results-message');
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –≤–∏–¥–µ–æ
    videoCards.forEach(card => {
        card.style.display = '';
    });
    
    // –°–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ "–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ"
    if (noResultsMessage) {
        noResultsMessage.style.display = 'none';
    }
    
    console.log('Search cleared - all videos shown');
}

// ============================================
// Video Functions
// ============================================

// External video opening (YouTube searches)
document.querySelectorAll('.video-open').forEach((btn) => {
    btn.addEventListener('click', () => {
        const url = btn.getAttribute('data-url');
        if (!url) return;
        hapticFeedback('impact');
        trackUserAction('video_external_opened', { url });
        if (tg && typeof tg.openLink === 'function') {
            tg.openLink(url);
        } else {
            window.open(url, '_blank', 'noopener,noreferrer');
        }
    });
});

function openVideo(videoId, title) {
    hapticFeedback('notification');
    trackUserAction('video_opened', { videoId, title });
    
    // Here you can implement video player
    if (tg && tg.showAlert) {
        tg.showAlert(`–û—Ç–∫—Ä—ã—Ç—å –≤–∏–¥–µ–æ: ${title}`);
    }
}

function addToFavorites(videoId) {
    hapticFeedback('notification');
    trackUserAction('video_favorited', { videoId });
    
    if (tg && tg.showAlert) {
        tg.showAlert('–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ');
    }
}

function shareVideo(videoId, title) {
    hapticFeedback('impact');
    trackUserAction('video_shared', { videoId, title });
    
    if (tg && tg.shareUrl) {
        tg.shareUrl(`https://example.com/video/${videoId}`, title);
    } else if (tg && tg.showAlert) {
        tg.showAlert('–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –≤–∏–¥–µ–æ: ' + title);
    }
}

// ============================================
// Haptic Feedback
// ============================================

function hapticFeedback(type = 'impact') {
    if (!tg || !tg.HapticFeedback) return;
    
    try {
        if (type === 'impact') {
            tg.HapticFeedback.impactOccurred('medium');
        } else if (type === 'notification') {
            tg.HapticFeedback.notificationOccurred('success');
        } else if (type === 'selection') {
            tg.HapticFeedback.selectionChanged();
        }
    } catch (e) {
        console.warn('Haptic feedback error:', e);
    }
}

// Add haptic feedback to interactive elements (excluding nav-items to avoid conflicts)
document.querySelectorAll('button:not(.nav-item), .grid-item').forEach(element => {
    element.addEventListener('touchstart', () => {
        hapticFeedback('impact');
    });
    
    element.addEventListener('click', () => {
        hapticFeedback('selection');
    });
});

// ============================================
// Data Communication with Bot
// ============================================

function sendDataToBot(data) {
    if (!tg || !tg.sendData) {
        console.warn('sendData not available');
        return false;
    }
    
    try {
        tg.sendData(JSON.stringify(data));
        return true;
    } catch (e) {
        console.error('Error sending data to bot:', e);
        return false;
    }
}

// ============================================
// Analytics & Tracking
// ============================================

function trackUserAction(action, data = {}) {
    const trackingData = {
        action: action,
        timestamp: Date.now(),
        platform: tg?.platform || 'unknown',
        version: tg?.version || 'unknown',
        ...data
    };
    
    // Get user ID if available
    const userData = getUserData();
    if (userData) {
        trackingData.userId = userData.id;
    }
    
    console.log('Tracking:', trackingData);
    
    // Send to bot if needed
    // sendDataToBot({ type: 'analytics', data: trackingData });
}

// ============================================
// Purchased Tools Management
// ============================================

const PURCHASED_TOOLS_KEY = 'purchased_tools';
const LAST_SYNC_KEY = 'last_sync_timestamp';

// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–∫—É–ø–∫–∞—Ö —Å —Å–∞–π—Ç–∞
// –í–ê–ñ–ù–û: –ù–ï —Ö—Ä–∞–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –≤ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–º –∫–æ–¥–µ! –≠—Ç–æ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ.
// –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω–µ.

// –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram WebApp API (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
// –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É —á–µ—Ä–µ–∑ tg.sendData(), –±–æ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
// –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ!

// –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤–Ω–µ—à–Ω–µ–≥–æ API (–µ—Å–ª–∏ –µ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–Ω—ã–π endpoint)
const PURCHASES_API_URL = 'https://your-api-domain.com/api/purchases'; // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à URL
const USE_API_SYNC = false; // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ true –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è API, false –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –±–æ—Ç–∞

/*
 * –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –ù–ê–°–¢–†–û–ô–ö–ï –ò–ù–¢–ï–ì–†–ê–¶–ò–ò –° –ë–û–¢–û–ú:
 * 
 * –í–ê–ñ–ù–û: –¢–æ–∫–µ–Ω –±–æ—Ç–∞ 
 * –ù–ï –î–û–õ–ñ–ï–ù –±—ã—Ç—å –≤ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–º –∫–æ–¥–µ! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–≥–æ —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.
 * 
 * –í–ê–†–ò–ê–ù–¢ 1: –ß–µ—Ä–µ–∑ Telegram WebApp API (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è, —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)
 * 
 * 1. –í –≤–∞—à–µ–º –±–æ—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∞–π—Ç–µ –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ tg.sendData():
 *    - –¢–∏–ø –∑–∞–ø—Ä–æ—Å–∞: 'get_purchases' –∏–ª–∏ 'sync_purchases'
 *    - userId: –ø–æ–ª—É—á–∞–µ—Ç—Å—è –∏–∑ initDataUnsafe.user.id
 * 
 * 2. –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ MainButton –∏–ª–∏ –¥—Ä—É–≥–æ–π –º–µ—Ö–∞–Ω–∏–∑–º:
 *    - –í—ã–∑–æ–≤–∏—Ç–µ window.receivePurchasesFromBot([...–º–∞—Å—Å–∏–≤ –ø–æ–∫—É–ø–æ–∫...])
 * 
 * –ü—Ä–∏–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ –±–æ—Ç–µ (Python):
 * 
 * @bot.message_handler(commands=['start'])
 * def handle_start(message):
 *     # –û–±—Ä–∞–±–æ—Ç–∫–∞ WebApp –¥–∞–Ω–Ω—ã—Ö
 *     pass
 * 
 * def handle_web_app_data(data):
 *     data = json.loads(data)
 *     if data.get('type') == 'get_purchases':
 *         user_id = data.get('userId')
 *         purchases = get_user_purchases(user_id)  # –í–∞—à–∞ —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–∫—É–ø–æ–∫
 *         # –û—Ç–ø—Ä–∞–≤—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –æ–±—Ä–∞—Ç–Ω–æ —á–µ—Ä–µ–∑ MainButton –∏–ª–∏ –¥—Ä—É–≥–æ–π —Å–ø–æ—Å–æ–±
 * 
 * –í–ê–†–ò–ê–ù–¢ 2: –ß–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–π API (–µ—Å–ª–∏ –µ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä)
 * 
 * 1. –°–æ–∑–¥–∞–π—Ç–µ —Å–µ—Ä–≤–µ—Ä–Ω—ã–π endpoint, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
 * 2. –£–∫–∞–∂–∏—Ç–µ URL –≤ PURCHASES_API_URL
 * 3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ USE_API_SYNC = true
 * 
 * –§–æ—Ä–º–∞—Ç API endpoint:
 * GET /api/purchases?userId={telegramUserId}&lastSync={timestamp}
 * 
 * –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç API (JSON):
 * {
 *   "success": true,
 *   "purchases": [
 *     {
 *       "id": "tool_123",
 *       "toolName": "APEXWOLT 48–í",
 *       "toolImage": "https://storage.yandexcloud.net/miniappp/assets/drill.webp",
 *       "purchaseDate": 1704067200000,
 *       "category": "–î—Ä–µ–ª–∏ –∏ —à—É—Ä—É–ø–æ–≤–µ—Ä—Ç—ã",
 *       "model": "APEXWOLT 48–í",
 *       "serialNumber": "SN123456"
 *     }
 *   ]
 * }
 */

// –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–∫—É–ø–∫–µ:
// {
//   id: string (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –ø–æ–∫—É–ø–∫–∏),
//   toolName: string (–Ω–∞–∑–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞),
//   toolImage: string (URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è),
//   purchaseDate: number (timestamp),
//   category: string (–∫–∞—Ç–µ–≥–æ—Ä–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞),
//   model: string (–º–æ–¥–µ–ª—å, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ),
//   serialNumber: string (—Å–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
// }

function getPurchasedTools() {
    try {
        const stored = localStorage.getItem(PURCHASED_TOOLS_KEY);
        if (!stored) return [];
        const tools = JSON.parse(stored);
        // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ –ø–æ–∫—É–ø–∫–∏ (–Ω–æ–≤—ã–µ —Å–Ω–∞—á–∞–ª–∞)
        return tools.sort((a, b) => b.purchaseDate - a.purchaseDate);
    } catch (e) {
        console.error('Error loading purchased tools:', e);
        return [];
    }
}

function savePurchasedTools(tools) {
    try {
        localStorage.setItem(PURCHASED_TOOLS_KEY, JSON.stringify(tools));
        return true;
    } catch (e) {
        console.error('Error saving purchased tools:', e);
        return false;
    }
}

function addPurchasedTool(toolData) {
    const tools = getPurchasedTools();
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ—Ç –ª–∏ —É–∂–µ —Ç–∞–∫–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ (–ø–æ ID –∏–ª–∏ –ø–æ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –Ω–∞–∑–≤–∞–Ω–∏—è –∏ –¥–∞—Ç—ã)
    const existingIndex = tools.findIndex(t => 
        t.id === toolData.id || 
        (t.toolName === toolData.toolName && 
         Math.abs(t.purchaseDate - toolData.purchaseDate) < 86400000) // –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –¥–Ω—è
    );
    
    if (existingIndex >= 0) {
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π
        tools[existingIndex] = { ...tools[existingIndex], ...toolData };
    } else {
        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π
        if (!toolData.id) {
            toolData.id = `tool_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
        }
        if (!toolData.purchaseDate) {
            toolData.purchaseDate = Date.now();
        }
        tools.push(toolData);
    }
    
    savePurchasedTools(tools);
    return tools;
}

function syncPurchasedToolsWithBot() {
    return new Promise((resolve, reject) => {
        const userData = getUserData();
        if (!userData || !userData.id) {
            reject(new Error('User data not available'));
            return;
        }
        
        const tools = getPurchasedTools();
        const lastSync = localStorage.getItem(LAST_SYNC_KEY);
        
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –±–æ—Ç—É
        const syncData = {
            type: 'sync_purchases',
            userId: userData.id,
            tools: tools,
            lastSync: lastSync ? parseInt(lastSync) : null
        };
        
        if (sendDataToBot(syncData)) {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
            localStorage.setItem(LAST_SYNC_KEY, Date.now().toString());
            
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –±–æ—Ç –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ —á–µ—Ä–µ–∑ MainButton –∏–ª–∏ –¥—Ä—É–≥–æ–π –º–µ—Ö–∞–Ω–∏–∑–º
            // –ó–¥–µ—Å—å –º—ã –ø—Ä–æ—Å—Ç–æ –æ—Ç–º–µ—á–∞–µ–º, —á—Ç–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–∞—á–∞—Ç–∞
            resolve(tools);
        } else {
            reject(new Error('Failed to send sync request'));
        }
    });
}

function requestPurchasesFromBot() {
    return new Promise((resolve, reject) => {
        const userData = getUserData();
        if (!userData || !userData.id) {
            reject(new Error('User data not available'));
            return;
        }
        
        const requestData = {
            type: 'get_purchases',
            userId: userData.id
        };
        
        if (sendDataToBot(requestData)) {
            // –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ callback –∏–ª–∏ MainButton
            resolve(true);
        } else {
            reject(new Error('Failed to request purchases'));
        }
    });
}

function updatePurchasedToolsFromBot(botTools) {
    if (!Array.isArray(botTools)) {
        console.warn('Invalid tools data from bot');
        return;
    }
    
    const currentTools = getPurchasedTools();
    const mergedTools = [...currentTools];
    
    // –û–±—ä–µ–¥–∏–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ: –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –∏–∑ –±–æ—Ç–∞, –æ–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ
    botTools.forEach(botTool => {
        const existingIndex = mergedTools.findIndex(t => t.id === botTool.id);
        if (existingIndex >= 0) {
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π
            mergedTools[existingIndex] = { ...mergedTools[existingIndex], ...botTool };
        } else {
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π
            if (!botTool.purchaseDate) {
                botTool.purchaseDate = Date.now();
            }
            mergedTools.push(botTool);
        }
    });
    
    savePurchasedTools(mergedTools);
    return mergedTools;
}

function formatPurchaseDate(timestamp) {
    const date = new Date(timestamp);
    const now = new Date();
    const diffTime = Math.abs(now - date);
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    
    if (diffDays === 1) {
        return '–°–µ–≥–æ–¥–Ω—è';
    } else if (diffDays === 2) {
        return '–í—á–µ—Ä–∞';
    } else if (diffDays <= 7) {
        return `${diffDays - 1} –¥–Ω–µ–π –Ω–∞–∑–∞–¥`;
    } else {
        return date.toLocaleDateString('ru-RU', {
            day: 'numeric',
            month: 'long',
            year: 'numeric'
        });
    }
}

function renderPurchasedTools() {
    const tools = getPurchasedTools();
    const listContainer = document.getElementById('my-tools-list');
    const emptyState = document.getElementById('my-tools-empty');
    
    if (!listContainer || !emptyState) return;
    
    if (tools.length === 0) {
        listContainer.style.display = 'none';
        emptyState.style.display = 'flex';
        return;
    }
    
    listContainer.style.display = 'grid';
    emptyState.style.display = 'none';
    
    listContainer.innerHTML = tools.map(tool => {
        const purchaseDate = formatPurchaseDate(tool.purchaseDate);
        const imageUrl = tool.toolImage || 'https://storage.yandexcloud.net/miniappp/assets/drill.webp';
        
        return `
            <div class="my-tool-card">
                <div class="my-tool-image">
                    <img src="${imageUrl}" alt="${tool.toolName}" onerror="this.src='https://storage.yandexcloud.net/miniappp/assets/drill.webp'">
                </div>
                <div class="my-tool-info">
                    <div class="my-tool-name">${tool.toolName}</div>
                    ${tool.model ? `<div class="my-tool-model" style="font-size: 13px; color: var(--text-secondary);">${tool.model}</div>` : ''}
                    <div class="my-tool-date">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                            <rect x="3" y="4" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
                            <path d="M16 2v4M8 2v4M3 10h18" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        –ö—É–ø–ª–µ–Ω–æ: ${purchaseDate}
                    </div>
                    ${tool.category ? `<div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">${tool.category}</div>` : ''}
                    <div class="my-tool-actions">
                        <button class="my-tool-action-btn primary" onclick="openToolInstructions('${tool.toolName}')">
                            –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
                        </button>
                        <button class="my-tool-action-btn secondary" onclick="viewToolDetails('${tool.id}')">
                            –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                        </button>
                    </div>
                </div>
            </div>
        `;
    }).join('');
}

function openToolInstructions(toolName) {
    hapticFeedback('impact');
    trackUserAction('tool_instruction_opened', { toolName });
    
    // –ò—â–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –¥–ª—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
    if (toolName.toLowerCase().includes('–¥—Ä–µ–ª—å') || toolName.toLowerCase().includes('—à—É—Ä—É–ø–æ–≤–µ—Ä—Ç')) {
        showToolsPage();
    } else {
        if (tg && tg.showAlert) {
            tg.showAlert(`–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è: ${toolName}\n\n–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.`);
        }
    }
}

function viewToolDetails(toolId) {
    hapticFeedback('impact');
    const tools = getPurchasedTools();
    const tool = tools.find(t => t.id === toolId);
    
    if (!tool) return;
    
    let details = `üì¶ ${tool.toolName}\n\n`;
    if (tool.model) details += `–ú–æ–¥–µ–ª—å: ${tool.model}\n`;
    if (tool.category) details += `–ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${tool.category}\n`;
    if (tool.serialNumber) details += `–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä: ${tool.serialNumber}\n`;
    details += `–î–∞—Ç–∞ –ø–æ–∫—É–ø–∫–∏: ${formatPurchaseDate(tool.purchaseDate)}`;
    
    if (tg && tg.showAlert) {
        tg.showAlert(details);
    }
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–∫—É–ø–∫–∞—Ö —á–µ—Ä–µ–∑ HTTP API —Å —Å–∞–π—Ç–∞
async function fetchPurchasesFromAPI() {
    const userData = getUserData();
    if (!userData || !userData.id) {
        throw new Error('User data not available');
    }
    
    const lastSync = localStorage.getItem(LAST_SYNC_KEY);
    
    // –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –∫ API
    const requestUrl = new URL(PURCHASES_API_URL);
    requestUrl.searchParams.append('userId', userData.id);
    if (lastSync) {
        requestUrl.searchParams.append('lastSync', lastSync);
    }
    
    try {
        const headers = {
            'Content-Type': 'application/json'
        };
        
        // –î–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ Telegram –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–µ—Å–ª–∏ API —Ç—Ä–µ–±—É–µ—Ç)
        if (tg && tg.initData) {
            headers['X-Telegram-Init-Data'] = tg.initData;
        }
        
        // –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –¥—Ä—É–≥–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ:
        // headers['Authorization'] = `Bearer ${userToken}`;
        
        const response = await fetch(requestUrl.toString(), {
            method: 'GET',
            headers: headers
        });
        
        if (!response.ok) {
            throw new Error(`API error: ${response.status} ${response.statusText}`);
        }
        
        const data = await response.json();
        
        // –û–∂–∏–¥–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç API:
        // {
        //   success: true,
        //   purchases: [
        //     {
        //       id: 'tool_123',
        //       toolName: 'APEXWOLT 48–í',
        //       toolImage: 'https://...',
        //       purchaseDate: 1704067200000,
        //       category: '–î—Ä–µ–ª–∏ –∏ —à—É—Ä—É–ø–æ–≤–µ—Ä—Ç—ã',
        //       model: 'APEXWOLT 48–í',
        //       serialNumber: 'SN123456'
        //     }
        //   ]
        // }
        
        if (data.success && Array.isArray(data.purchases)) {
            const updatedTools = updatePurchasedToolsFromBot(data.purchases);
            localStorage.setItem(LAST_SYNC_KEY, Date.now().toString());
            return updatedTools;
        } else {
            throw new Error('Invalid API response format');
        }
    } catch (error) {
        console.error('API fetch error:', error);
        throw error;
    }
}

async function refreshPurchasedTools() {
    const refreshBtn = document.getElementById('refresh-purchases');
    if (refreshBtn) {
        refreshBtn.classList.add('loading');
        refreshBtn.disabled = true;
        refreshBtn.style.pointerEvents = 'none';
    }
    
    try {
        hapticFeedback('impact');
        
        let updatedTools = [];
        
        if (USE_API_SYNC && PURCHASES_API_URL && PURCHASES_API_URL !== 'https://your-api-domain.com/api/purchases') {
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å —Å–∞–π—Ç–∞
            try {
                updatedTools = await fetchPurchasesFromAPI();
                
                if (tg && tg.showAlert) {
                    tg.showAlert(`–°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω!\n\n–í—Å–µ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤: ${updatedTools.length}`);
                }
                
                trackUserAction('purchases_refreshed_api', { count: updatedTools.length });
            } catch (apiError) {
                console.error('API sync failed, trying bot sync:', apiError);
                // Fallback –Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ –±–æ—Ç–∞, –µ—Å–ª–∏ API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
                await requestPurchasesFromBot();
                if (tg && tg.showAlert) {
                    tg.showAlert('–ó–∞–ø—Ä–æ—Å –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω —á–µ—Ä–µ–∑ –±–æ—Ç–∞. –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.');
                }
                trackUserAction('purchases_refreshed_bot_fallback');
            }
        } else {
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ –±–æ—Ç–∞
            await requestPurchasesFromBot();
            
            if (tg && tg.showAlert) {
                tg.showAlert('–ó–∞–ø—Ä–æ—Å –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω. –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.');
            }
            
            trackUserAction('purchases_refreshed_bot');
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        renderPurchasedTools();
        
    } catch (e) {
        console.error('Error refreshing purchases:', e);
        if (tg && tg.showAlert) {
            tg.showAlert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
        }
        trackUserAction('purchases_refresh_error', { error: e.message });
    } finally {
        if (refreshBtn) {
            refreshBtn.classList.remove('loading');
            refreshBtn.disabled = false;
            refreshBtn.style.pointerEvents = 'auto';
            refreshBtn.style.cursor = 'pointer';
        }
    }
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ—Ç –±–æ—Ç–∞ (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –±–æ—Ç–æ–º —á–µ—Ä–µ–∑ MainButton –∏–ª–∏ –¥—Ä—É–≥–æ–π –º–µ—Ö–∞–Ω–∏–∑–º)
// –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –≤—ã–∑–≤–∞—Ç—å —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
// –ü—Ä–∏–º–µ—Ä –≤—ã–∑–æ–≤–∞ –∏–∑ –±–æ—Ç–∞:
//   window.receivePurchasesFromBot([
//     {
//       id: 'tool_123',
//       toolName: 'APEXWOLT 48–í',
//       toolImage: 'https://storage.yandexcloud.net/miniappp/assets/drill.webp',
//       purchaseDate: 1704067200000,
//       category: '–î—Ä–µ–ª–∏ –∏ —à—É—Ä—É–ø–æ–≤–µ—Ä—Ç—ã',
//       model: 'APEXWOLT 48–í',
//       serialNumber: 'SN123456'
//     }
//   ]);
window.receivePurchasesFromBot = function(botTools) {
    try {
        const updatedTools = updatePurchasedToolsFromBot(botTools);
        renderPurchasedTools();
        trackUserAction('purchases_synced', { count: updatedTools.length });
        
        if (tg && tg.showAlert) {
            tg.showAlert(`–°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω. –í—Å–µ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤: ${updatedTools.length}`);
        }
    } catch (e) {
        console.error('Error receiving purchases from bot:', e);
    }
};

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–º–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å –∏–∑ –∫–æ–Ω—Å–æ–ª–∏)
// –ü—Ä–∏–º–µ—Ä: window.addTestPurchase({ toolName: '–¢–µ—Å—Ç–æ–≤—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç', category: '–î—Ä–µ–ª–∏' })
window.addTestPurchase = function(toolData) {
    const testTool = {
        toolName: toolData.toolName || '–¢–µ—Å—Ç–æ–≤—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç',
        toolImage: toolData.toolImage || 'https://storage.yandexcloud.net/miniappp/assets/drill.webp',
        category: toolData.category || '–î—Ä–µ–ª–∏ –∏ —à—É—Ä—É–ø–æ–≤–µ—Ä—Ç—ã',
        model: toolData.model || '',
        purchaseDate: toolData.purchaseDate || Date.now()
    };
    
    addPurchasedTool(testTool);
    renderPurchasedTools();
    console.log('Test purchase added:', testTool);
};

// ============================================
// App Initialization
// ============================================

function initApp() {
    // Apply theme
    applyTelegramTheme();
    
    // Handle viewport
    handleViewportChange();
    
    // Get and log user data
    const userData = getUserData();
    if (userData) {
        console.log('Telegram User:', userData);
        trackUserAction('app_opened', { 
            userId: userData.id,
            username: userData.username,
            isPremium: userData.isPremium
        });
    } else {
        console.log('User data not available');
        trackUserAction('app_opened');
    }
    
    // Log platform info
    console.log('Platform:', tg?.platform);
    console.log('Version:', tg?.version);
    console.log('Init Data:', getInitDataUnsafe());
    
    // Set initial back button state
    hideBackButton();
    
    // Load and render purchased tools
    renderPurchasedTools();
    
    // Try to sync purchases on startup (silently)
    setTimeout(() => {
        if (USE_API_SYNC && PURCHASES_API_URL && PURCHASES_API_URL !== 'https://your-api-domain.com/api/purchases') {
            // –ü—ã—Ç–∞–µ–º—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ API
            fetchPurchasesFromAPI()
                .then(tools => {
                    renderPurchasedTools();
                    console.log('Purchases synced from API on startup:', tools.length);
                })
                .catch(() => {
                    // Silently fail if API is not available
                    console.log('API sync failed on startup, will try bot sync');
                    requestPurchasesFromBot().catch(() => {
                        // Silently fail if bot is not available
                    });
                });
        } else {
            // –ü—ã—Ç–∞–µ–º—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ –±–æ—Ç–∞
            requestPurchasesFromBot().catch(() => {
                // Silently fail if bot is not available
            });
        }
    }, 1000);
    
    // Mark app as ready
    document.body.classList.add('app-ready');
}


// Initialize when DOM is ready
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initApp);
} else {
    initApp();
}

// Export functions for global use
window.TelegramApp = {
    tg,
    getUserData,
    sendDataToBot,
    trackUserAction,
    openVideo,
    addToFavorites,
    shareVideo,
    hapticFeedback,
    navigateToPage,
    getPurchasedTools,
    addPurchasedTool,
    updatePurchasedToolsFromBot,
    renderPurchasedTools,
    refreshPurchasedTools,
    fetchPurchasesFromAPI
};
    </script>
</body>
</html>
